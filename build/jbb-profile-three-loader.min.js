/* THREE.js profile loader for JBB - https://github.com/wavesoft/jbb-profile-three */
var JBB=JBB||{};JBB.Loader=JBB.Loader||{},JBB.Loader.three=function(e){function t(a){if(r[a])return r[a].exports;var i=r[a]={exports:{},id:a,loaded:!1};return e[a].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){(function(t){"use strict";var a=r(1),i=(r(2),r(4)),s=new i;e.exports={initialize:function(e){var i=new Function("try {return this===window;}catch(e){ return false;}");i()||(t.THREE=a,t.THREE.XHRLoader=r(26)),e&&e()},load:function(e,t,r,a){return s.load(e,t,function(e,t){var i={};i[r]=e,t&&(i[r+":extra"]=t),a(null,i)})}}}).call(t,function(){return this}())},function(e,t){e.exports=THREE},function(e,t,r){(function(e){function r(e,t){for(var r=0,a=e.length-1;a>=0;a--){var i=e[a];"."===i?e.splice(a,1):".."===i?(e.splice(a,1),r++):r&&(e.splice(a,1),r--)}if(t)for(;r--;r)e.unshift("..");return e}function a(e,t){if(e.filter)return e.filter(t);for(var r=[],a=0;a<e.length;a++)t(e[a],a,e)&&r.push(e[a]);return r}var i=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,s=function(e){return i.exec(e).slice(1)};t.resolve=function(){for(var t="",i=!1,s=arguments.length-1;s>=-1&&!i;s--){var n=s>=0?arguments[s]:e.cwd();if("string"!=typeof n)throw new TypeError("Arguments to path.resolve must be strings");n&&(t=n+"/"+t,i="/"===n.charAt(0))}return t=r(a(t.split("/"),function(e){return!!e}),!i).join("/"),(i?"/":"")+t||"."},t.normalize=function(e){var i=t.isAbsolute(e),s="/"===n(e,-1);return e=r(a(e.split("/"),function(e){return!!e}),!i).join("/"),e||i||(e="."),e&&s&&(e+="/"),(i?"/":"")+e},t.isAbsolute=function(e){return"/"===e.charAt(0)},t.join=function(){var e=Array.prototype.slice.call(arguments,0);return t.normalize(a(e,function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e}).join("/"))},t.relative=function(e,r){function a(e){for(var t=0;t<e.length&&""===e[t];t++);for(var r=e.length-1;r>=0&&""===e[r];r--);return t>r?[]:e.slice(t,r-t+1)}e=t.resolve(e).substr(1),r=t.resolve(r).substr(1);for(var i=a(e.split("/")),s=a(r.split("/")),n=Math.min(i.length,s.length),o=n,h=0;n>h;h++)if(i[h]!==s[h]){o=h;break}for(var c=[],h=o;h<i.length;h++)c.push("..");return c=c.concat(s.slice(o)),c.join("/")},t.sep="/",t.delimiter=":",t.dirname=function(e){var t=s(e),r=t[0],a=t[1];return r||a?(a&&(a=a.substr(0,a.length-1)),r+a):"."},t.basename=function(e,t){var r=s(e)[2];return t&&r.substr(-1*t.length)===t&&(r=r.substr(0,r.length-t.length)),r},t.extname=function(e){return s(e)[3]};var n="b"==="ab".substr(-1)?function(e,t,r){return e.substr(t,r)}:function(e,t,r){return 0>t&&(t=e.length+t),e.substr(t,r)}}).call(t,r(3))},function(e,t){function r(){c&&n&&(c=!1,n.length?h=n.concat(h):l=-1,h.length&&a())}function a(){if(!c){var e=setTimeout(r);c=!0;for(var t=h.length;t;){for(n=h,h=[];++l<t;)n&&n[l].run();l=-1,t=h.length}n=null,c=!1,clearTimeout(e)}}function i(e,t){this.fun=e,this.array=t}function s(){}var n,o=e.exports={},h=[],c=!1,l=-1;o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];h.push(new i(e,t)),1!==h.length||c||setTimeout(a,0)},i.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=s,o.addListener=s,o.once=s,o.off=s,o.removeListener=s,o.removeAllListeners=s,o.emit=s,o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,t,r){function a(){this.loaders={}}var i=r(1);r(5),r(6),r(7),r(8),r(9),r(10),r(12),r(13),r(14),r(15),r(16),r(17),r(18),r(19),r(20),r(21),r(22),r(23),r(24),r(25),a.prototype.load=function(e,t,r){if("THREE."==e.substr(0,6)){var a=e.split("."),s=this.loaders[e];if(void 0==s){var e=i[a[1]];if(void 0==i[a[1]])throw"Could not find the specified loader!";s=new e,this.loaders[e]=s}return s.load(t,r),!0}return!1},e.exports=a},function(e,t,r){var a=r(1);!function(){function e(){this.id=0,this.data=null}var t=1,r=2,i=3,s=4,n=5,o=6,h=7,c=8,l=21,d=23,u=41,p=42,f=43,m=44,g=45,v=46,y=47,b=21,w=23,x=4,_=5,A=7,k=8,T=!0;AWDProperties=function(){},AWDProperties.prototype={set:function(e,t){this[e]=t},get:function(e,t){return this.hasOwnProperty(e)?this[e]:t}},a.AWDLoader=function(t){this.manager=void 0!==t?t:a.DefaultLoadingManager,this.trunk=new a.Object3D,this.materialFactory=void 0,this._url="",this._baseDir="",this._data,this._ptr=0,this._version=[],this._streaming=!1,this._optimized_for_accuracy=!1,this._compression=0,this._bodylen=4294967295,this._blocks=[new e],this._accuracyMatrix=!1,this._accuracyGeo=!1,this._accuracyProps=!1},a.AWDLoader.prototype={constructor:a.AWDLoader,load:function(e,t,r,i){var s=this;this._url=e,this._baseDir=e.substr(0,e.lastIndexOf("/")+1);var n=new a.XHRLoader(this.manager);n.setCrossOrigin(this.crossOrigin),n.setResponseType("arraybuffer"),n.load(e,function(e){t(s.parse(e))},r,i)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=e.byteLength;for(this._ptr=0,this._data=new DataView(e),this._parseHeader(),0!=this._compression&&console.error("compressed AWD not supported"),this._streaming||this._bodylen==e.byteLength-this._ptr||console.error("AWDLoader: body len does not match file length",this._bodylen,t-this._ptr);this._ptr<t;)this.parseNextBlock();return this.trunk},parseNextBlock:function(){var t,r,a,i,s=this.readU32(),r=(this.readU8(),this.readU8()),a=(this.readU8(),this.readU32());switch(r){case 1:t=this.parseMeshData(a);break;case 22:t=this.parseContainer(a);break;case 23:t=this.parseMeshInstance(a);break;case 81:t=this.parseMaterial(a);break;case 82:t=this.parseTexture(a);break;case 101:t=this.parseSkeleton(a);break;case 112:t=this.parseMeshPoseAnimation(a,!1);break;case 113:t=this.parseVertexAnimationSet(a);break;case 102:t=this.parseSkeletonPose(a);break;case 103:t=this.parseSkeletonAnimation(a);break;case 122:t=this.parseAnimatorSet(a);break;default:this._ptr+=a}this._blocks[s]=i=new e,i.data=t,i.id=s},_parseHeader:function(){var e=this._version,t=this.readU8()<<16|this.readU8()<<8|this.readU8();if(4282180!=t)throw new Error("AWDLoader - bad magic");e[0]=this.readU8(),e[1]=this.readU8();var r=this.readU16();this._streaming=1==(1&r),2===e[0]&&1===e[1]&&(this._accuracyMatrix=2===(2&r),this._accuracyGeo=4===(4&r),this._accuracyProps=8===(8&r)),this._geoNrType=this._accuracyGeo?k:A,this._matrixNrType=this._accuracyMatrix?k:A,this._propsNrType=this._accuracyProps?k:A,this._optimized_for_accuracy=2===(2&r),this._compression=this.readU8(),this._bodylen=this.readU32()},parseContainer:function(e){var t,r=new a.Object3D,i=this.readU32(),s=this.parseMatrix4();return r.name=this.readUTF(),r.applyMatrix(s),t=this._blocks[i].data||this.trunk,t.add(r),this.parseProperties({1:this._matrixNrType,2:this._matrixNrType,3:this._matrixNrType,4:x}),r.extra=this.parseUserAttributes(),r},parseMeshInstance:function(e){var t,r,i,s,n,o,h,c,l,d,u,p,f,m,g;for(o=this.readU32(),c=this.parseMatrix4(),t=this.readUTF(),h=this.readU32(),p=this.readU16(),i=this.getBlock(h),l=[],f=0,g=0;p>g;g++)u=this.readU32(),d=this.getBlock(u),l.push(d);if(s=i.length,n=[],s>1)for(r=new a.Object3D,g=0;s>g;g++){var v=new a.Mesh(i[g]);n.push(v),r.add(v)}else r=new a.Mesh(i[0]),n.push(r);r.applyMatrix(c),r.name=t,m=this.getBlock(o)||this.trunk,m.add(r);var y=l.length,b=Math.max(s,y);for(g=0;b>g;g++)n[g%s].material=l[g%y];return this.parseProperties(null),r.extra=this.parseUserAttributes(),r},parseMaterial:function(e){var t,r,s,n,o,c,u;for(t=this.readUTF(),r=this.readU8(),c=this.readU8(),s=this.parseProperties({1:i,2:d,11:l,12:h,13:l}),u=0;c>u;){this.readU16();this.parseProperties(null),this.parseUserAttributes()}if(o=this.parseUserAttributes(),void 0!==this.materialFactory&&(n=this.materialFactory(t)))return n;if(n=new a.MeshPhongMaterial,1===r)n.color.setHex(s.get(1,13421772));else if(2===r){var p=s.get(2,0);n.map=this.getBlock(p)}return n.extra=o,n.alphaThreshold=s.get(12,0),n.repeat=s.get(13,!1),n},parseTexture:function(e){var t,r,a=(this.readUTF(),this.readU8());if(0===a){r=this.readU32();var i=this.readUTFBytes(r);console.log(i),t=this.loadTexture(i)}return this.parseProperties(null),this.parseUserAttributes(),t},loadTexture:function(e){var t=new a.Texture,r=new a.ImageLoader(this.manager);return r.load(this._baseDir+e,function(e){t.image=e,t.needsUpdate=!0}),t},parseSkeleton:function(e){var t=(this.readUTF(),this.readU16()),r=[],i=0;for(this.parseProperties(null);t>i;){var s,n;this.readU16(),s=new a.Bone,s.parent=this.readU16()-1,s.name=this.readUTF(),n=this.parseMatrix4(),s.skinMatrix=n,this.parseProperties(null),this.parseUserAttributes(),r.push(s),i++}return this.parseUserAttributes(),r},parseSkeletonPose:function(e){var t=(this.readUTF(),this.readU16());this.parseProperties(null);for(var r=[],i=0;t>i;){var s,n;s=this.readU8(),n=1===s?this.parseMatrix4():new a.Matrix4,r[i]=n,i++}return this.parseUserAttributes(),r},parseSkeletonAnimation:function(e){var t,r,a,i=(this.readUTF(),[]),s=this.readU16();this.parseProperties(null);for(var n=0;s>n;)r=this.readU32(),t=this.readU16(),a=this._blocks[r].data,i.push({pose:a,duration:t}),n++;return 0!==i.length?(this.parseUserAttributes(),i):void 0},parseVertexAnimationSet:function(e){for(var t,r=(this.readUTF(),this.readU16()),a=(this.parseProperties({1:_}),0),i=[];r>a;)t=this.readU32(),i.push(this._blocks[t].data),a++;return this.parseUserAttributes(),i},parseAnimatorSet:function(e){var t,r,a=(this.readUTF(),this.readU16()),i=this.parseProperties({1:w});t=this.readU32();for(var s=this.readU16(),n=[],o=0;s>o;o++)n.push(this.readU32());this.readU16(),Boolean(this.readU8());this.parseUserAttributes(),this.parseUserAttributes();var h=[];for(o=0;o<n.length;o++)h.push(this._blocks[n[o]].data);r=this._blocks[t].data;var c;for(1==a&&(c={animationSet:r,skeleton:this._blocks[i.get(1,0)].data}),o=0;o<h.length;o++)h[o].animator=c;return c},parseMeshData:function(e){var t,r,i,s=this.readUTF(),n=this.readU16(),o=0,h=[];for(r=this.parseProperties({1:this._geoNrType,2:this._geoNrType});n>o;){var c,l,d;for(t=new a.BufferGeometry,t.name=s,h.push(t),c=this.readU32(),l=this._ptr+c,this.parseProperties({1:this._geoNrType,2:this._geoNrType});this._ptr<l;){var u=0,p=this.readU8(),f=(this.readU8(),this.readU32()),m=f+this._ptr;if(1===p)for(i=new Float32Array(f/12*3),d=new a.BufferAttribute(i,3),t.addAttribute("position",d),u=0;this._ptr<m;)i[u]=-this.readF32(),i[u+1]=this.readF32(),i[u+2]=this.readF32(),u+=3;else if(2===p)for(i=new Uint16Array(f/2),d=new a.BufferAttribute(i,1),t.setIndex(d),u=0;this._ptr<m;)i[u+1]=this.readU16(),i[u]=this.readU16(),i[u+2]=this.readU16(),u+=3;else if(3===p)for(i=new Float32Array(f/8*2),d=new a.BufferAttribute(i,2),t.addAttribute("uv",d),u=0;this._ptr<m;)i[u]=this.readF32(),i[u+1]=1-this.readF32(),u+=2;else if(4===p)for(i=new Float32Array(f/12*3),d=new a.BufferAttribute(i,3),t.addAttribute("normal",d),u=0;this._ptr<m;)i[u]=-this.readF32(),i[u+1]=this.readF32(),i[u+2]=this.readF32(),u+=3;else this._ptr=m}this.parseUserAttributes(),t.computeBoundingSphere(),o++}return this.parseUserAttributes(),h},parseMeshPoseAnimation:function(e,t){var r,a,i,s,n,o,h,c,l,d,u=1,p=0,f={},m=[],g=(this.readUTF(),this.readU32()),v=this.getBlock(g);if(null===v)return void console.log("parseMeshPoseAnimation target mesh not found at:",g);for(h=v.geometry,h.morphTargets=[],t||(u=this.readU16()),r=this.readU16(),c=this.readU16(),l=0;c>l;)m.push(this.readU16()),l++;for(d=this.parseProperties({1:b,2:b}),f.looping=d.get(1,!0),f.stitchFinalFrame=d.get(2,!1),a=0;u>a;){for(s=this.readU16(),i=0;r>i;)for(l=0,n=this.readU32(),o=this._ptr+n;c>l;){if(1===m[l]){var y=new Float32Array(n/4);for(h.morphTargets.push({array:y}),p=0;this._ptr<o;)y[p]=this.readF32(),y[p+1]=this.readF32(),y[p+2]=this.readF32(),p+=3;i++}else this._ptr=o;l++}a++}return this.parseUserAttributes(),null},getBlock:function(e){return this._blocks[e].data},parseMatrix4:function(){var e=new a.Matrix4,t=e.elements;return t[0]=this.readF32(),t[1]=this.readF32(),t[2]=this.readF32(),t[3]=0,t[4]=this.readF32(),t[5]=this.readF32(),t[6]=this.readF32(),t[7]=0,t[8]=this.readF32(),t[9]=this.readF32(),t[10]=this.readF32(),t[11]=0,t[12]=-this.readF32(),t[13]=this.readF32(),t[14]=this.readF32(),t[15]=1,e},parseProperties:function(e){var t=this.readU32(),r=this._ptr+t,a=new AWDProperties;if(e)for(;this._ptr<r;){var i,s=this.readU16(),n=this.readU32();e.hasOwnProperty(s)?(i=e[s],a.set(s,this.parseAttrValue(i,n))):this._ptr+=n}return a},parseUserAttributes:function(){return this._ptr=this.readU32()+this._ptr,null},parseAttrValue:function(e,a){var b,w;switch(e){case t:b=1,w=this.readI8;break;case r:b=2,w=this.readI16;break;case i:b=4,w=this.readI32;break;case l:case s:b=1,w=this.readU8;break;case n:b=2,w=this.readU16;break;case o:case d:b=4,w=this.readU32;break;case h:b=4,w=this.readF32;break;case c:b=8,w=this.readF64;break;case u:case p:case f:case m:case g:case v:case y:b=8,w=this.readF64}if(a>b){var x,_,A;for(x=[],_=0,A=a/b;A>_;)x.push(w.call(this)),_++;return x}return w.call(this)},readU8:function(){return this._data.getUint8(this._ptr++)},readI8:function(){return this._data.getInt8(this._ptr++)},readU16:function(){var e=this._data.getUint16(this._ptr,T);return this._ptr+=2,e},readI16:function(){var e=this._data.getInt16(this._ptr,T);return this._ptr+=2,e},readU32:function(){var e=this._data.getUint32(this._ptr,T);return this._ptr+=4,e},readI32:function(){var e=this._data.getInt32(this._ptr,T);return this._ptr+=4,e},readF32:function(){var e=this._data.getFloat32(this._ptr,T);return this._ptr+=4,e},readF64:function(){var e=this._data.getFloat64(this._ptr,T);return this._ptr+=8,e},readUTF:function(){var e=this.readU16();return this.readUTFBytes(e)},readUTFBytes:function(e){for(var t=[],r=0;t.length<e;){var a=this._data.getUint8(this._ptr++,T);if(128>a)t[r++]=String.fromCharCode(a);else if(a>191&&224>a){var i=this._data.getUint8(this._ptr++,T);t[r++]=String.fromCharCode((31&a)<<6|63&i)}else{var i=this._data.getUint8(this._ptr++,T),s=this._data.getUint8(this._ptr++,T);t[r++]=String.fromCharCode((15&a)<<12|(63&i)<<6|63&s)}}return t.join("")}}}()},function(e,t,r){var a=r(1);a.BabylonLoader=function(e){this.manager=void 0!==e?e:a.DefaultLoadingManager},a.BabylonLoader.prototype={constructor:a.ObjectLoader,load:function(e,t,r,i){var s=this,n=new a.XHRLoader(s.manager);n.setCrossOrigin(this.crossOrigin),n.load(e,function(e){t(s.parse(JSON.parse(e)))},r,i)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=this.parseMaterials(e),r=this.parseObjects(e,t);return r},parseMaterials:function(e){for(var t={},r=0,i=e.materials.length;i>r;r++){var s=e.materials[r],n=new a.MeshPhongMaterial;n.name=s.name,n.color.fromArray(s.diffuse),n.emissive.fromArray(s.emissive),n.specular.fromArray(s.specular),n.shininess=s.specularPower,n.opacity=s.alpha,t[s.id]=n}if(e.multiMaterials)for(var r=0,i=e.multiMaterials.length;i>r;r++){var s=e.multiMaterials[r];console.warn("THREE.BabylonLoader: Multi materials not yet supported."),t[s.id]=new a.MeshPhongMaterial}return t},parseGeometry:function(e){var t=new a.BufferGeometry,r=new Uint16Array(e.indices);t.setIndex(new a.BufferAttribute(r,1));for(var i=new Float32Array(e.positions),s=2,n=i.length;n>s;s+=3)i[s]=-i[s];if(t.addAttribute("position",new a.BufferAttribute(i,3)),e.normals){for(var o=new Float32Array(e.normals),s=2,n=o.length;n>s;s+=3)o[s]=-o[s];t.addAttribute("normal",new a.BufferAttribute(o,3))}if(e.uvs){var h=new Float32Array(e.uvs);t.addAttribute("uv",new a.BufferAttribute(h,2))}var c=e.subMeshes;if(c)for(var s=0,n=c.length;n>s;s++){var l=c[s];t.addGroup(l.indexStart,l.indexCount)}return t},parseObjects:function(e,t){for(var r={},i=new a.Scene,s=e.cameras,n=0,o=s.length;o>n;n++){var h=s[n],c=new a.PerspectiveCamera(h.fov/Math.PI*180,1.33,h.minZ,h.maxZ);c.name=h.name,c.position.fromArray(h.position),h.rotation&&c.rotation.fromArray(h.rotation),r[h.id]=c}for(var l=e.lights,n=0,o=l.length;o>n;n++){var d,h=l[n];switch(h.type){case 0:d=new a.PointLight;break;case 1:d=new a.DirectionalLight;break;case 2:d=new a.SpotLight;break;case 3:d=new a.HemisphereLight}d.name=h.name,h.position&&d.position.set(h.position[0],h.position[1],-h.position[2]),d.color.fromArray(h.diffuse),h.groundColor&&d.groundColor.fromArray(h.groundColor),h.intensity&&(d.intensity=h.intensity),r[h.id]=d,i.add(d)}for(var u=e.meshes,n=0,o=u.length;o>n;n++){var p,h=u[n];if(h.indices){var f=this.parseGeometry(h);p=new a.Mesh(f,t[h.materialId])}else p=new a.Group;p.name=h.name,p.position.set(h.position[0],h.position[1],-h.position[2]),p.rotation.fromArray(h.rotation),h.rotationQuaternion&&p.quaternion.fromArray(h.rotationQuaternion),p.scale.fromArray(h.scaling),h.parentId?r[h.parentId].add(p):i.add(p),r[h.id]=p}return i}}},function(e,t,r){var a=r(1);a.BinaryLoader=function(e){"boolean"==typeof e&&(console.warn("THREE.BinaryLoader: showStatus parameter has been removed from constructor."),e=void 0),this.manager=void 0!==e?e:a.DefaultLoadingManager},a.BinaryLoader.prototype={constructor:a.BinaryLoader,get statusDomElement(){return void 0===this._statusDomElement&&(this._statusDomElement=document.createElement("div")),console.warn("THREE.BinaryLoader: .statusDomElement has been removed."),this._statusDomElement},load:function(e,t,r,i){var s=this.texturePath||a.Loader.prototype.extractUrlBase(e),n=this.binaryPath||a.Loader.prototype.extractUrlBase(e),o=this,h=new a.XHRLoader(this.manager);h.setCrossOrigin(this.crossOrigin),h.load(e,function(e){var h=JSON.parse(e),c=n+h.buffers,l=new a.XHRLoader(o.manager);l.setCrossOrigin(o.crossOrigin),l.setResponseType("arraybuffer"),l.load(c,function(e){o.parse(e,t,s,h.materials)},r,i)},r,i)},setBinaryPath:function(e){this.binaryPath=e},setCrossOrigin:function(e){this.crossOrigin=e},setTexturePath:function(e){this.texturePath=e},parse:function(e,t,r,i){var s=function(t){function r(e){return e%4?4-e%4:0}function i(e,t){var r={signature:s(e,t,12),header_bytes:n(e,t+12),vertex_coordinate_bytes:n(e,t+13),normal_coordinate_bytes:n(e,t+14),uv_coordinate_bytes:n(e,t+15),vertex_index_bytes:n(e,t+16),normal_index_bytes:n(e,t+17),uv_index_bytes:n(e,t+18),material_index_bytes:n(e,t+19),nvertices:o(e,t+20),nnormals:o(e,t+20+4),nuvs:o(e,t+20+8),ntri_flat:o(e,t+20+12),ntri_smooth:o(e,t+20+16),ntri_flat_uv:o(e,t+20+20),ntri_smooth_uv:o(e,t+20+24),nquad_flat:o(e,t+20+28),nquad_smooth:o(e,t+20+32),nquad_flat_uv:o(e,t+20+36),nquad_smooth_uv:o(e,t+20+40)};return r}function s(e,t,r){for(var a=new Uint8Array(e,t,r),i="",s=0;r>s;s++)i+=String.fromCharCode(a[t+s]);return i}function n(e,t){var r=new Uint8Array(e,t,1);return r[0]}function o(e,t){var r=new Uint32Array(e,t,1);return r[0]}function h(t){var r,i,s,n,o=T.nvertices,h=new Float32Array(e,t,3*o);for(r=0;o>r;r++)i=h[3*r],s=h[3*r+1],n=h[3*r+2],q.vertices.push(new a.Vector3(i,s,n));return 3*o*Float32Array.BYTES_PER_ELEMENT}function c(t){var r=T.nnormals;if(r){var a,i,s,n,o=new Int8Array(e,t,3*r);for(a=0;r>a;a++)i=o[3*a],s=o[3*a+1],n=o[3*a+2],X.push(i/127,s/127,n/127)}return 3*r*Int8Array.BYTES_PER_ELEMENT}function l(t){var r=T.nuvs;if(r){var a,i,s,n=new Float32Array(e,t,2*r);for(a=0;r>a;a++)i=n[2*a],s=n[2*a+1],Y.push(i,s)}return 2*r*Float32Array.BYTES_PER_ELEMENT}function d(t,r){var i,s,n,o,h,c,l,d,u,p,f=new Uint32Array(e,r,3*t);for(i=0;t>i;i++)s=f[3*i],n=f[3*i+1],o=f[3*i+2],h=Y[2*s],d=Y[2*s+1],c=Y[2*n],u=Y[2*n+1],l=Y[2*o],p=Y[2*o+1],q.faceVertexUvs[0].push([new a.Vector2(h,d),new a.Vector2(c,u),new a.Vector2(l,p)])}function u(t,r){var i,s,n,o,h,c,l,d,u,p,f,m,g,v=new Uint32Array(e,r,4*t);for(i=0;t>i;i++)s=v[4*i],n=v[4*i+1],o=v[4*i+2],h=v[4*i+3],c=Y[2*s],p=Y[2*s+1],l=Y[2*n],f=Y[2*n+1],d=Y[2*o],m=Y[2*o+1],u=Y[2*h],g=Y[2*h+1],q.faceVertexUvs[0].push([new a.Vector2(c,p),new a.Vector2(l,f),new a.Vector2(u,g)]),q.faceVertexUvs[0].push([new a.Vector2(l,f),new a.Vector2(d,m),new a.Vector2(u,g)])}function p(t,r,i){var s,n,o,h,c,l=new Uint32Array(e,r,3*t),d=new Uint16Array(e,i,t);for(s=0;t>s;s++)n=l[3*s],o=l[3*s+1],h=l[3*s+2],c=d[s],q.faces.push(new a.Face3(n,o,h,null,null,c))}function f(t,r,i){var s,n,o,h,c,l,d=new Uint32Array(e,r,4*t),u=new Uint16Array(e,i,t);for(s=0;t>s;s++)n=d[4*s],o=d[4*s+1],h=d[4*s+2],c=d[4*s+3],l=u[s],q.faces.push(new a.Face3(n,o,c,null,null,l)),q.faces.push(new a.Face3(o,h,c,null,null,l))}function m(t,r,i,s){var n,o,h,c,l,d,u,p,f=new Uint32Array(e,r,3*t),m=new Uint32Array(e,i,3*t),g=new Uint16Array(e,s,t);for(n=0;t>n;n++){o=f[3*n],h=f[3*n+1],c=f[3*n+2],d=m[3*n],u=m[3*n+1],p=m[3*n+2],l=g[n];var v=X[3*d],y=X[3*d+1],b=X[3*d+2],w=X[3*u],x=X[3*u+1],_=X[3*u+2],A=X[3*p],k=X[3*p+1],T=X[3*p+2];q.faces.push(new a.Face3(o,h,c,[new a.Vector3(v,y,b),new a.Vector3(w,x,_),new a.Vector3(A,k,T)],null,l))}}function g(t,r,i,s){var n,o,h,c,l,d,u,p,f,m,g=new Uint32Array(e,r,4*t),v=new Uint32Array(e,i,4*t),y=new Uint16Array(e,s,t);for(n=0;t>n;n++){o=g[4*n],h=g[4*n+1],c=g[4*n+2],l=g[4*n+3],u=v[4*n],p=v[4*n+1],f=v[4*n+2],m=v[4*n+3],d=y[n];var b=X[3*u],w=X[3*u+1],x=X[3*u+2],_=X[3*p],A=X[3*p+1],k=X[3*p+2],T=X[3*f],M=X[3*f+1],C=X[3*f+2],L=X[3*m],N=X[3*m+1],U=X[3*m+2];q.faces.push(new a.Face3(o,h,l,[new a.Vector3(b,w,x),new a.Vector3(_,A,k),new a.Vector3(L,N,U)],null,d)),q.faces.push(new a.Face3(h,c,l,[new a.Vector3(_,A,k),new a.Vector3(T,M,C),new a.Vector3(L,N,U)],null,d))}}function v(e){var t=T.ntri_flat;if(t){var r=e+t*Uint32Array.BYTES_PER_ELEMENT*3;p(t,e,r)}}function y(e){var t=T.ntri_flat_uv;if(t){var r=e+t*Uint32Array.BYTES_PER_ELEMENT*3,a=r+t*Uint32Array.BYTES_PER_ELEMENT*3;p(t,e,a),d(t,r)}}function b(e){var t=T.ntri_smooth;if(t){var r=e+t*Uint32Array.BYTES_PER_ELEMENT*3,a=r+t*Uint32Array.BYTES_PER_ELEMENT*3;m(t,e,r,a)}}function w(e){var t=T.ntri_smooth_uv;if(t){var r=e+t*Uint32Array.BYTES_PER_ELEMENT*3,a=r+t*Uint32Array.BYTES_PER_ELEMENT*3,i=a+t*Uint32Array.BYTES_PER_ELEMENT*3;m(t,e,r,i),d(t,a)}}function x(e){var t=T.nquad_flat;if(t){var r=e+t*Uint32Array.BYTES_PER_ELEMENT*4;f(t,e,r)}}function _(e){var t=T.nquad_flat_uv;if(t){var r=e+t*Uint32Array.BYTES_PER_ELEMENT*4,a=r+t*Uint32Array.BYTES_PER_ELEMENT*4;f(t,e,a),u(t,r)}}function A(e){var t=T.nquad_smooth;if(t){var r=e+t*Uint32Array.BYTES_PER_ELEMENT*4,a=r+t*Uint32Array.BYTES_PER_ELEMENT*4;g(t,e,r,a)}}function k(e){var t=T.nquad_smooth_uv;if(t){var r=e+t*Uint32Array.BYTES_PER_ELEMENT*4,a=r+t*Uint32Array.BYTES_PER_ELEMENT*4,i=a+t*Uint32Array.BYTES_PER_ELEMENT*4;g(t,e,r,i),u(t,a)}}var T,M,C,L,N,U,E,F,B,O,R,S,I,P,D,V,j,G,H,q=this,z=0,X=[],Y=[];a.Geometry.call(this),T=i(e,z),z+=T.header_bytes,O=3*T.vertex_index_bytes+T.material_index_bytes,R=4*T.vertex_index_bytes+T.material_index_bytes,S=T.ntri_flat*O,I=T.ntri_smooth*(O+3*T.normal_index_bytes),P=T.ntri_flat_uv*(O+3*T.uv_index_bytes),D=T.ntri_smooth_uv*(O+3*T.normal_index_bytes+3*T.uv_index_bytes),V=T.nquad_flat*R,j=T.nquad_smooth*(R+4*T.normal_index_bytes),G=T.nquad_flat_uv*(R+4*T.uv_index_bytes),H=T.nquad_smooth_uv*(R+4*T.normal_index_bytes+4*T.uv_index_bytes),z+=h(z),z+=c(z),z+=r(3*T.nnormals),z+=l(z),M=z,C=M+S+r(2*T.ntri_flat),L=C+I+r(2*T.ntri_smooth),N=L+P+r(2*T.ntri_flat_uv),U=N+D+r(2*T.ntri_smooth_uv),E=U+V+r(2*T.nquad_flat),F=E+j+r(2*T.nquad_smooth),B=F+G+r(2*T.nquad_flat_uv),y(L),w(N),_(F),k(B),v(M),b(C),x(U),A(E),this.computeFaceNormals()};s.prototype=Object.create(a.Geometry.prototype),s.prototype.constructor=s;var n=new s(r),o=a.Loader.prototype.initMaterials(i,r,this.crossOrigin);t(n,o)}}},function(e,t,r){var a=r(1);!function(){function e(){this.id="",this.init_from=""}function t(){this.id="",this.name="",this.type="",this.skin=null,this.morph=null}function r(){this.method=null,this.source=null,this.targets=null,this.weights=null}function i(){this.source="",this.bindShapeMatrix=null,this.invBindMatrices=[],this.joints=[],this.weights=[]}function s(){this.id="",this.name="",this.nodes=[],this.scene=new a.Group}function n(){this.id="",this.name="",this.sid="",this.nodes=[],this.controllers=[],this.transforms=[],this.geometries=[],this.channels=[],this.matrix=new a.Matrix4}function o(){this.sid="",this.type="",this.data=[],this.obj=null}function h(){this.url="",this.skeleton=[],this.instance_material=[]}function c(){this.symbol="",this.target=""}function l(){this.url="",this.instance_material=[]}function d(){this.id="",this.mesh=null}function u(e){this.geometry=e.id,this.primitives=[],this.vertices=null,this.geometry3js=null}function p(){this.material="",this.count=0,this.inputs=[],this.vcount=null,this.p=[],this.geometry=new a.Geometry}function f(){p.call(this),this.vcount=[]}function m(){p.call(this),this.vcount=1}function g(){p.call(this),this.vcount=3}function v(){this.source="",this.count=0,this.stride=0,this.params=[]}function y(){this.input={}}function b(){this.semantic="",this.offset=0,this.source="",this.set=0}function w(e){this.id=e,this.type=null}function x(){this.id="",this.name="",this.instance_effect=null}function _(){this.color=new a.Color,this.color.setRGB(Math.random(),Math.random(),Math.random()),this.color.a=1,this.texture=null,this.texcoord=null,this.texOpts=null}function A(e,t){this.type=e,this.effect=t,this.material=null}function k(e){this.effect=e,this.init_from=null,this.format=null}function T(e){this.effect=e,this.source=null,this.wrap_s=null,this.wrap_t=null,this.minfilter=null,this.magfilter=null,this.mipfilter=null}function M(){this.id="",this.name="",this.shader=null,this.surface={},this.sampler={}}function C(){this.url=""}function L(){this.id="",this.name="",this.source={},this.sampler=[],this.channel=[]}function N(e){this.animation=e,this.source="",this.target="",this.fullSid=null,this.sid=null,this.dotSyntax=null,this.arrSyntax=null,this.arrIndices=null,this.member=null}function U(e){this.id="",this.animation=e,this.inputs=[],this.input=null,this.output=null,this.strideOut=null,this.interpolation=null,this.startTime=null,this.endTime=null,this.duration=0}function E(e){this.targets=[],this.time=e}function F(){this.id="",this.name="",this.technique=""}function B(){this.url=""}function O(){this.id="",this.name="",this.technique=""}function R(){this.url=""}function S(){this.id="",this.name="",this.joints=[],this.links=[]}function I(){this.sid="",this.name="",this.axis=new a.Vector3,this.limits={min:0,max:0},this.type="",this["static"]=!1,this.zeroPosition=0,this.middlePosition=0}function P(){this.sid="",this.name="",this.transforms=[],this.attachments=[]}function D(){this.joint="",this.transforms=[],this.links=[]}function V(e){var t=e.getAttribute("id");return void 0!=Le[t]?Le[t]:(Le[t]=new w(t).parse(e),Le[t])}function j(e){for(var t=q(e),r=[],a=0,i=t.length;i>a;a++)r.push("true"===t[a]||"1"===t[a]);return r}function G(e){for(var t=q(e),r=[],a=0,i=t.length;i>a;a++)r.push(parseFloat(t[a]));return r}function H(e){for(var t=q(e),r=[],a=0,i=t.length;i>a;a++)r.push(parseInt(t[a],10));return r}function q(e){return e.length>0?z(e).split(/\s+/):[]}function z(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")}function X(e,t,r){return e.hasAttribute(t)?parseInt(e.getAttribute(t),10):r}function Y(e,t){var r=new a.ImageLoader;r.load(t,function(t){e.image=t,e.needsUpdate=!0})}function W(e,t,r){var i=Ee[t.url];if(r=void 0!==r?r:40,!i||!i.skin)return void console.log("ColladaLoader: Could not find skin controller.");if(!t.skeleton||!t.skeleton.length)return void console.log("ColladaLoader: Could not find the skeleton for the skin. ");for(var s=J(),n=ve.getChildById(t.skeleton[0],!0)||ve.getChildBySid(t.skeleton[0],!0),o=re(n),h=i.skin.joints,c=[],l=0;l<h.length;l++)for(var d=0;d<o.length;d++)o[d].name===h[l]&&(c[l]=o[d]);for(var l=0;l<c.length;l++)for(var d=0;d<c.length;d++)c[l].parent===c[d].name&&(c[l].parent=d);var l,d,u;new a.Vector3;for(l=0;l<e.vertices.length;l++)e.vertices[l].applyMatrix4(i.skin.bindShapeMatrix);for(var p=[],f=[],m=i.skin.weights,l=0;l<m.length;l++){var g=new a.Vector4(m[l][0]?m[l][0].joint:0,m[l][1]?m[l][1].joint:0,m[l][2]?m[l][2].joint:0,m[l][3]?m[l][3].joint:0),u=new a.Vector4(m[l][0]?m[l][0].weight:0,m[l][1]?m[l][1].weight:0,m[l][2]?m[l][2].weight:0,m[l][3]?m[l][3].weight:0);p.push(g),f.push(u)}e.skinIndices=p,e.skinWeights=f,e.bones=c;for(var v={name:s.ID,fps:30,length:s.frames/30,hierarchy:[]},d=0;d<c.length;d++)v.hierarchy.push({parent:c[d].parent,name:c[d].name,keys:[]});for(console.log("ColladaLoader:",s.ID+" has "+c.length+" bones."),ge(e,n,i),r=0;r<s.frames;r++){var y=[];fe(n,y,r),me(y,i.skin);for(var l=0;l<y.length;l++)for(var d=0;d<v.hierarchy.length;d++)if(v.hierarchy[d].name===y[l].sid){var b={};b.time=r/30,b.matrix=y[l].animatrix,0===r&&(y[l].matrix=b.matrix);var w=[new a.Vector3,new a.Quaternion,new a.Vector3];b.matrix.decompose(w[0],w[1],w[2]),b.pos=[w[0].x,w[0].y,w[0].z],b.scl=[w[2].x,w[2].y,w[2].z],b.rot=w[1],v.hierarchy[d].keys.push(b)}e.animation=v}}function J(){var e,t=1e6,r=-t,a=0;for(var i in Ue){var s=Ue[i];e=e||s.id;for(var n=0;n<s.sampler.length;n++){var o=s.sampler[n];o.create(),t=Math.min(t,o.startTime),r=Math.max(r,o.endTime),a=Math.max(a,o.input.length)}}return{start:t,end:r,frames:a,ID:e}}function Z(e,t){var r,i,s,n,o=new a.Object3D,h=!1;for(s=0;s<e.controllers.length;s++){var c=Ee[e.controllers[s].url];switch(c.type){case"skin":if(Fe[c.skin.source]){var d=new l;d.url=c.skin.source,d.instance_material=e.controllers[s].instance_material,e.geometries.push(d),h=!0,r=e.controllers[s]}else if(Ee[c.skin.source]){var u=Ee[c.skin.source];if(i=u,u.morph&&Fe[u.morph.source]){var d=new l;d.url=u.morph.source,d.instance_material=e.controllers[s].instance_material,e.geometries.push(d)}}break;case"morph":if(Fe[c.morph.source]){var d=new l;d.url=c.morph.source,d.instance_material=e.controllers[s].instance_material,e.geometries.push(d),i=e.controllers[s]}console.log("ColladaLoader: Morph-controller partially supported.")}}var p={};for(s=0;s<e.geometries.length;s++){var f,m=e.geometries[s],g=m.instance_material,v=Fe[m.url],y={},b=[],w=0;if(v){if(!v.mesh||!v.mesh.primitives)continue;if(0===o.name.length&&(o.name=v.id),g)for(n=0;n<g.length;n++){var x=g[n],_=Be[x.target],A=_.instance_effect.url,k=Oe[A].shader,T=k.material;if(v.doubleSided){if(!(x.symbol in p)){var M=T.clone();M.side=a.DoubleSide,p[x.symbol]=M}T=p[x.symbol]}T.opacity=T.opacity?T.opacity:1,y[x.symbol]=w,b.push(T),f=T,f.name=null===_.name||""===_.name?_.id:_.name,w++}var C,L=f||new a.MeshLambertMaterial({color:14540253,side:v.doubleSided?a.DoubleSide:a.FrontSide}),N=v.mesh.geometry3js;if(w>1)for(L=new a.MeshFaceMaterial(b),n=0;n<N.faces.length;n++){var U=N.faces[n];U.materialIndex=y[U.daeMaterial]}void 0!==r?(W(N,r),N.morphTargets.length>0?(L.morphTargets=!0,L.skinning=!1):(L.morphTargets=!1,L.skinning=!0),C=new a.SkinnedMesh(N,L,!1),C.name="skin_"+Te.length,Te.push(C)):void 0!==i?(createMorph(N,i),L.morphTargets=!0,C=new a.Mesh(N,L),C.name="morph_"+ke.length,ke.push(C)):C=N.isLineStrip===!0?new a.Line(N):new a.Mesh(N,L),o.add(C)}}for(s=0;s<e.cameras.length;s++){var E=e.cameras[s],F=Re[E.url],B=new a.PerspectiveCamera(F.yfov,parseFloat(F.aspect_ratio),parseFloat(F.znear),parseFloat(F.zfar));o.add(B)}for(s=0;s<e.lights.length;s++){var O=null,R=e.lights[s],S=Se[R.url];if(S&&S.technique){var I,P=S.color.getHex(),D=S.intensity,V=S.distance,j=S.falloff_angle;switch(S.technique){case"directional":O=new a.DirectionalLight(P,D,V),O.position.set(0,0,1);break;case"point":O=new a.PointLight(P,D,V);break;case"spot":O=new a.SpotLight(P,D,V,j,I),O.position.set(0,0,1);break;case"ambient":O=new a.AmbientLight(P)}}O&&o.add(O)}if(o.name=e.name||e.id||"",o.colladaId=e.id||"",o.layer=e.layer||"",o.matrix=e.matrix,o.matrix.decompose(o.position,o.quaternion,o.scale),je.centerGeometry&&o.geometry){var G=o.geometry.center();G.multiply(o.scale),G.applyQuaternion(o.quaternion),o.position.sub(G)}for(s=0;s<e.nodes.length;s++)o.add(Z(e.nodes[s],e));return o}function $(e){if(e.channels&&e.channels.length){for(var t=[],r=[],a=0,i=e.channels.length;i>a;a++){var s,n=e.channels[a],o=n.fullSid,h=n.sampler,c=h.input,l=e.getTransformBySid(n.sid);if(n.arrIndices){s=[];for(var d=0,u=n.arrIndices.length;u>d;d++)s[d]=ne(n.arrIndices[d])}else s=he(n.member);
if(l){-1===r.indexOf(o)&&r.push(o);for(var d=0,u=c.length;u>d;d++){var p=c[d],f=h.getData(l.type,d,s),m=Q(t,p);if(!m){m=new E(p);var g=ee(t,p);t.splice(-1===g?t.length:g,0,m)}m.addTarget(o,l,s,f)}}else console.log('Could not find transform "'+n.sid+'" in node '+e.id)}for(var a=0;a<r.length;a++)for(var v=r[a],d=0;d<t.length;d++){var m=t[d];m.hasTarget(v)||ue(t,m,d,v)}e.keys=t,e.sids=r}}function K(e,t){e.doubleSided=!1;var r=t.querySelectorAll("extra double_sided")[0];r&&r&&1===parseInt(r.textContent,10)&&(e.doubleSided=!0)}function Q(e,t){for(var r=null,a=0,i=e.length;i>a&&null===r;a++){var s=e[a];if(s.time===t)r=s;else if(s.time>t)break}return r}function ee(e,t){for(var r=-1,a=0,i=e.length;i>a&&-1===r;a++){var s=e[a];s.time>=t&&(r=a)}return r}function te(e,t){if(je.convertUpAxis===!0&&De!==je.upAxis)switch(Ve){case"XtoY":var r=e[0];e[0]=t*e[1],e[1]=r;break;case"XtoZ":var r=e[2];e[2]=e[1],e[1]=e[0],e[0]=r;break;case"YtoX":var r=e[0];e[0]=e[1],e[1]=t*r;break;case"YtoZ":var r=e[1];e[1]=t*e[2],e[2]=r;break;case"ZtoX":var r=e[0];e[0]=e[1],e[1]=e[2],e[2]=r;break;case"ZtoY":var r=e[1];e[1]=e[2],e[2]=t*r}}function re(e){var t=[],r=function(e,t,i){var s={};s.name=t.sid,s.parent=e,s.matrix=t.matrix;var n=[new a.Vector3,new a.Quaternion,new a.Vector3];s.matrix.decompose(n[0],n[1],n[2]),s.pos=[n[0].x,n[0].y,n[0].z],s.scl=[n[2].x,n[2].y,n[2].z],s.rotq=[n[1].x,n[1].y,n[1].z,n[1].w],i.push(s);for(var o in t.nodes)r(t.sid,t.nodes[o],i)};return r(-1,e,t),t}function ae(e,t){if(je.convertUpAxis!==!0||De===je.upAxis)return t;switch(e){case"X":t="XtoY"===Ve?-1*t:t;break;case"Y":t="YtoZ"===Ve||"YtoX"===Ve?-1*t:t;break;case"Z":t="ZtoY"===Ve?-1*t:t}return t}function ie(e,t){var r=[e[t],e[t+1],e[t+2]];return te(r,-1),new a.Vector3(r[0],r[1],r[2])}function se(e){if(je.convertUpAxis){var t=[e[0],e[4],e[8]];te(t,-1),e[0]=t[0],e[4]=t[1],e[8]=t[2],t=[e[1],e[5],e[9]],te(t,-1),e[1]=t[0],e[5]=t[1],e[9]=t[2],t=[e[2],e[6],e[10]],te(t,-1),e[2]=t[0],e[6]=t[1],e[10]=t[2],t=[e[0],e[1],e[2]],te(t,-1),e[0]=t[0],e[1]=t[1],e[2]=t[2],t=[e[4],e[5],e[6]],te(t,-1),e[4]=t[0],e[5]=t[1],e[6]=t[2],t=[e[8],e[9],e[10]],te(t,-1),e[8]=t[0],e[9]=t[1],e[10]=t[2],t=[e[3],e[7],e[11]],te(t,-1),e[3]=t[0],e[7]=t[1],e[11]=t[2]}return(new a.Matrix4).set(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function ne(e){if(e>-1&&3>e){var t=["X","Y","Z"],r={X:0,Y:1,Z:2};e=he(t[e]),e=r[e]}return e}function oe(e){var t=[],r=1e6,a=-1e6;for(var i in Ue)for(var s=Ue[i],n=0;n<s.channel.length;n++){var o=s.channel[n],h=s.sampler[n],i=o.target.split("/")[0];i==e.id&&(h.create(),o.sampler=h,r=Math.min(r,h.startTime),a=Math.max(a,h.endTime),t.push(o))}return t.length&&(e.startTime=r,e.endTime=a),t}function he(e){if(je.convertUpAxis)switch(e){case"X":switch(Ve){case"XtoY":case"XtoZ":case"YtoX":e="Y";break;case"ZtoX":e="Z"}break;case"Y":switch(Ve){case"XtoY":case"YtoX":case"ZtoX":e="X";break;case"XtoZ":case"YtoZ":case"ZtoY":e="Z"}break;case"Z":switch(Ve){case"XtoZ":e="X";break;case"YtoZ":case"ZtoX":case"ZtoY":e="Y"}}return e}function ce(e){for(var t=Me.querySelectorAll("library_nodes node"),r=0;r<t.length;r++){var a=t[r].attributes.getNamedItem("id");if(a&&a.value===e)return t[r]}}function le(e,t,r){for(;r<e.length;r++){var a=e[r];if(a.hasTarget(t))return a}return null}function de(e,t,r){for(r=r>=0?r:r+e.length;r>=0;r--){var a=e[r];if(a.hasTarget(t))return a}return null}function ue(e,t,r,a){var i=de(e,a,r?r-1:0),s=le(e,a,r+1);if(i&&s){var n,o=(t.time-i.time)/(s.time-i.time),h=i.getTarget(a),c=s.getTarget(a).data,l=h.data;if("matrix"===h.type)n=l;else if(l.length){n=[];for(var d=0;d<l.length;++d)n[d]=l[d]+(c[d]-l[d])*o}else n=l+(c-l)*o;t.addTarget(a,h.transform,h.member,n)}}function pe(e){var t=ve.getChildById(e.colladaId,!0),r=null;if(t&&t.keys){r={fps:60,hierarchy:[{node:t,keys:t.keys,sids:t.sids}],node:e,name:"animation_"+e.name,length:0},be.push(r);for(var a=0,i=t.keys.length;i>a;a++)r.length=Math.max(r.length,t.keys[a].time)}else r={hierarchy:[{keys:[],sids:[]}]};for(var a=0,i=e.children.length;i>a;a++)for(var s=pe(e.children[a]),n=0,o=s.hierarchy.length;o>n;n++)r.hierarchy.push({keys:[],sids:[]});return r}function fe(e,t,r,i){if(e.world=e.world||new a.Matrix4,e.localworld=e.localworld||new a.Matrix4,e.world.copy(e.matrix),e.localworld.copy(e.matrix),e.channels&&e.channels.length){var s=e.channels[0],n=s.sampler.output[r];n instanceof a.Matrix4&&(e.world.copy(n),e.localworld.copy(n),0===r&&e.matrix.copy(n))}i&&e.world.multiplyMatrices(i,e.world),t.push(e);for(var o=0;o<e.nodes.length;o++)fe(e.nodes[o],t,r,e.world)}function me(e,t){for(var r=0;r<e.length;r++){var i=e[r],s=-1;if("JOINT"==i.type){for(var n=0;n<t.joints.length;n++)if(i.sid===t.joints[n]){s=n;break}if(s>=0){var o=t.invBindMatrices[s];i.invBindMatrix=o,i.skinningMatrix=new a.Matrix4,i.skinningMatrix.multiplyMatrices(i.world,o),i.animatrix=new a.Matrix4,i.animatrix.copy(i.localworld),i.weights=[];for(var n=0;n<t.weights.length;n++)for(var h=0;h<t.weights[n].length;h++){var c=t.weights[n][h];c.joint===s&&i.weights.push(c)}}else console.warn("ColladaLoader: Could not find joint '"+i.sid+"'."),i.skinningMatrix=new a.Matrix4,i.weights=[]}}}function ge(e,t,r){var i=[];fe(t,i,-1),me(i,r.skin);for(var s=new a.Vector3,n=[],o=0;o<e.vertices.length;o++)n.push(new a.Vector3);for(var o=0;o<i.length;o++)if("JOINT"==i[o].type)for(var h=0;h<i[o].weights.length;h++){var c=i[o].weights[h],l=c.index,d=c.weight,u=e.vertices[l],p=n[l];s.x=u.x,s.y=u.y,s.z=u.z,s.applyMatrix4(i[o].skinningMatrix),p.x+=s.x*d,p.y+=s.y*d,p.z+=s.z*d}for(var o=0;o<e.vertices.length;o++)e.vertices[o]=n[o]}var ve,ye,be,we,xe,_e,Ae,ke,Te,Me=null,Ce=null,Le={},Ne={},Ue={},Ee={},Fe={},Be={},Oe={},Re={},Se={},Ie=a.SmoothShading,Pe=1,De="Y",Ve=null,je={centerGeometry:!1,convertUpAxis:!1,subdivideFaces:!0,upAxis:"Y",defaultEnvMap:null};a.ColladaLoader=function(e){this.manager=void 0!==e?e:a.DefaultLoadingManager},a.ColladaLoader.prototype={constructor:a.ColladaLoader,options:je,load:function(e,t,r,i){if(document.implementation&&document.implementation.createDocument){var s=this,n=new a.XHRLoader(this.manager);n.setCrossOrigin(this.crossOrigin),n.load(e,function(r){var a=e.split("/");a.pop(),Ae=(a.length<1?".":a.join("/"))+"/";var i=new DOMParser,n=i.parseFromString(r,"application/xml");t(s.parse(n,e))},r,i)}else alert("Don't know how to parse XML!")},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(r){Me=r,this.parseAsset(),this.setUpConversion(),Ne=this.parseLib("library_images image",e,"image"),Be=this.parseLib("library_materials material",x,"material"),Oe=this.parseLib("library_effects effect",M,"effect"),Fe=this.parseLib("library_geometries geometry",d,"geometry"),Re=this.parseLib("library_cameras camera",F,"camera"),Se=this.parseLib("library_lights light",O,"light"),Ee=this.parseLib("library_controllers controller",t,"controller"),Ue=this.parseLib("library_animations animation",L,"animation"),xe=this.parseLib("library_visual_scenes visual_scene",s,"visual_scene"),_e=this.parseLib("library_kinematics_models kinematics_model",S,"kinematics_model"),ke=[],Te=[],ve=this.parseScene(),Ce=new a.Group;for(var i=0;i<ve.nodes.length;i++)Ce.add(Z(ve.nodes[i]));Ce.scale.multiplyScalar(Pe),this.createAnimations(),ye=this.parseKinematicsModel(),this.createKinematics();var n={scene:Ce,morphs:ke,skins:Te,animations:be,kinematics:we,dae:{images:Ne,materials:Be,cameras:Re,lights:Se,effects:Oe,geometries:Fe,controllers:Ee,animations:Ue,visualScenes:xe,visualScene:ve,scene:ve,kinematicsModels:_e,kinematicsModel:ye}};return n},setPreferredShading:function(e){Ie=e},parseAsset:function(){var e=Me.querySelectorAll("asset"),t=e[0];if(t&&t.childNodes)for(var r=0;r<t.childNodes.length;r++){var a=t.childNodes[r];switch(a.nodeName){case"unit":var i=a.getAttribute("meter");i&&(Pe=parseFloat(i));break;case"up_axis":De=a.textContent.charAt(0)}}},parseLib:function(e,t,r){for(var a=Me.querySelectorAll(e),i={},s=0,n=a.length,o=0;n>o;o++){var h=a[o],c=(new t).parse(h);c.id&&0!==c.id.length||(c.id=r+s++),i[c.id]=c}return i},parseScene:function(){var e=Me.querySelectorAll("scene instance_visual_scene")[0];if(e){var t=e.getAttribute("url").replace(/^#/,"");return xe[t.length>0?t:"visual_scene0"]}return null},parseKinematicsModel:function(){var e=Me.querySelectorAll("instance_kinematics_model")[0];if(e){var t=e.getAttribute("url").replace(/^#/,"");return _e[t.length>0?t:"kinematics_model0"]}return null},createAnimations:function(){be=[],pe(Ce)},recurseHierarchy:function(e){var t=ve.getChildById(e.colladaId,!0),r=null;if(t&&t.keys){r={fps:60,hierarchy:[{node:t,keys:t.keys,sids:t.sids}],node:e,name:"animation_"+e.name,length:0},be.push(r);for(var a=0,i=t.keys.length;i>a;a++)r.length=Math.max(r.length,t.keys[a].time)}else r={hierarchy:[{keys:[],sids:[]}]};for(var a=0,i=e.children.length;i>a;a++)for(var s=pe(e.children[a]),n=0,o=s.hierarchy.length;o>n;n++)r.hierarchy.push({keys:[],sids:[]});return r},createMorph:function(e,t){var r=t instanceof h?Ee[t.url]:t;if(!r||!r.morph)return void console.log("could not find morph controller!");for(var a=r.morph,i=0;i<a.targets.length;i++){var s=a.targets[i],n=Fe[s];if(n.mesh&&n.mesh.primitives&&n.mesh.primitives.length){var o=n.mesh.primitives[0].geometry;o.vertices.length===e.vertices.length&&e.morphTargets.push({name:"target_1",vertices:o.vertices})}}e.morphTargets.push({name:"target_Z",vertices:e.vertices})},createSkin:function(e,t,r){var a=Ee[t.url];if(!a||!a.skin)return void console.log("could not find skin controller!");if(!t.skeleton||!t.skeleton.length)return void console.log("could not find the skeleton for the skin!");var i=a.skin;ve.getChildById(t.skeleton[0]);r=void 0!==r?r:!0;if(e.skinWeights=[],e.skinIndices=[],r)for(var s=0;s<e.vertices.length;s++)e.vertices[s].applyMatrix4(i.bindShapeMatrix)},createKinematics:function(){if(ye&&0===ye.joints.length)return void(we=void 0);var e={},t=function(t,r){var a=r.getAttribute("id"),i=ve.getChildById(a,!0),s=ye.joints[t];Ce.traverse(function(r){r.colladaId==a&&(e[t]={node:r,transforms:i.transforms,joint:s,position:s.zeroPosition})})};we={joints:ye&&ye.joints,getJointValue:function(t){var r=e[t];return r?r.position:void console.log("getJointValue: joint "+t+" doesn't exist")},setJointValue:function(t,r){var s=e[t];if(s){var n=s.joint;if(r>n.limits.max||r<n.limits.min)console.log("setJointValue: joint "+t+" value "+r+" outside of limits (min: "+n.limits.min+", max: "+n.limits.max+")");else if(n["static"])console.log("setJointValue: joint "+t+" is static");else{var o=s.node,h=n.axis,c=s.transforms,l=new a.Matrix4;for(i=0;i<c.length;i++){var d=c[i];if(d.sid&&-1!==d.sid.indexOf("joint"+t))switch(n.type){case"revolute":l.multiply(u.makeRotationAxis(h,a.Math.degToRad(r)));break;case"prismatic":l.multiply(u.makeTranslation(h.x*r,h.y*r,h.z*r));break;default:console.warn("setJointValue: unknown joint type: "+n.type)}else{var u=new a.Matrix4;switch(d.type){case"matrix":l.multiply(d.obj);break;case"translate":l.multiply(u.makeTranslation(d.obj.x,d.obj.y,d.obj.z));break;case"rotate":l.multiply(u.makeRotationAxis(d.obj,d.angle))}}}var p=l.elements,f=Array.prototype.slice.call(p),m=[f[0],f[4],f[8],f[12],f[1],f[5],f[9],f[13],f[2],f[6],f[10],f[14],f[3],f[7],f[11],f[15]];o.matrix.set.apply(o.matrix,m),o.matrix.decompose(o.position,o.quaternion,o.scale)}}else console.log("setJointValue: joint "+t+" doesn't exist")}};var r=Me.querySelector("scene instance_kinematics_scene");if(r)for(var i=0;i<r.childNodes.length;i++){var s=r.childNodes[i];if(1==s.nodeType)switch(s.nodeName){case"bind_joint_axis":var n=s.getAttribute("target").split("/").pop(),o=s.querySelector("axis param").textContent,h=parseInt(o.split("joint").pop().split(".")[0]),c=Me.querySelector('[sid="'+n+'"]');if(c){var l=c.parentElement;t(h,l)}}}},getJointId:function(e,t){for(var r=0;r<e.joints.length;r++)if(e.joints[r]===t)return r},calcFrameDuration:function(e){for(var t=1e7,r=0;r<e.channels.length;r++)for(var a=e.channels[r].sampler,i=0;i<a.input.length-1;i++){var s=a.input[i],n=a.input[i+1];t=Math.min(t,n-s)}return t},calcMatrixAt:function(e,t){var r,i,s={};for(r=0;r<e.channels.length;r++){var n=e.channels[r];s[n.sid]=n}var o=new a.Matrix4;for(r=0;r<e.transforms.length;r++){var h=e.transforms[r],n=s[h.sid];if(void 0!==n){var c,l=n.sampler;for(i=0;i<l.input.length-1;i++)if(l.input[i+1]>t){c=l.output[i];break}void 0!==c&&c instanceof a.Matrix4?o.multiplyMatrices(o,c):o.multiplyMatrices(o,h.matrix)}else o.multiplyMatrices(o,h.matrix)}return o},setUpConversion:function(){if(je.convertUpAxis!==!0||De===je.upAxis)Ve=null;else switch(De){case"X":Ve="Y"===je.upAxis?"XtoY":"XtoZ";break;case"Y":Ve="X"===je.upAxis?"YtoX":"YtoZ";break;case"Z":Ve="X"===je.upAxis?"ZtoX":"ZtoY"}}},e.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];"init_from"===r.nodeName&&(this.init_from=r.textContent)}return this},t.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.type="none";for(var t=0;t<e.childNodes.length;t++){var a=e.childNodes[t];switch(a.nodeName){case"skin":this.skin=(new i).parse(a),this.type=a.nodeName;break;case"morph":this.morph=(new r).parse(a),this.type=a.nodeName}}return this},r.prototype.parse=function(e){var t,r={},a=[];for(this.method=e.getAttribute("method"),this.source=e.getAttribute("source").replace(/^#/,""),t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"source":var s=(new w).parse(i);r[s.id]=s;break;case"targets":a=this.parseInputs(i);break;default:console.log(i.nodeName)}}for(t=0;t<a.length;t++){var n=a[t],s=r[n.source];switch(n.semantic){case"MORPH_TARGET":this.targets=s.read();break;case"MORPH_WEIGHT":this.weights=s.read()}}return this},r.prototype.parseInputs=function(e){for(var t=[],r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1==a.nodeType)switch(a.nodeName){case"input":t.push((new b).parse(a))}}return t},i.prototype.parse=function(e){var t,r,a={};this.source=e.getAttribute("source").replace(/^#/,""),this.invBindMatrices=[],this.joints=[],this.weights=[];for(var i=0;i<e.childNodes.length;i++){var s=e.childNodes[i];if(1==s.nodeType)switch(s.nodeName){case"bind_shape_matrix":var n=G(s.textContent);this.bindShapeMatrix=se(n);break;case"source":var o=(new w).parse(s);a[o.id]=o;break;case"joints":t=s;break;case"vertex_weights":r=s;break;default:console.log(s.nodeName)}}return this.parseJoints(t,a),this.parseWeights(r,a),this},i.prototype.parseJoints=function(e,t){for(var r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1==a.nodeType)switch(a.nodeName){case"input":var i=(new b).parse(a),s=t[i.source];"JOINT"===i.semantic?this.joints=s.read():"INV_BIND_MATRIX"===i.semantic&&(this.invBindMatrices=s.read())}}},i.prototype.parseWeights=function(e,t){for(var r,a,i=[],s=0;s<e.childNodes.length;s++){var n=e.childNodes[s];if(1==n.nodeType)switch(n.nodeName){case"input":i.push((new b).parse(n));break;case"v":r=H(n.textContent);break;case"vcount":a=H(n.textContent)}}for(var o=0,s=0;s<a.length;s++){for(var h=a[s],c=[],l=0;h>l;l++){for(var d={},u=0;u<i.length;u++){var p=i[u],f=r[o+p.offset];switch(p.semantic){case"JOINT":d.joint=f;break;case"WEIGHT":d.weight=t[p.source].data[f]}}c.push(d),o+=i.length}for(var l=0;l<c.length;l++)c[l].index=s;this.weights.push(c)}},s.prototype.getChildById=function(e,t){for(var r=0;r<this.nodes.length;r++){var a=this.nodes[r].getChildById(e,t);if(a)return a}return null},s.prototype.getChildBySid=function(e,t){for(var r=0;r<this.nodes.length;r++){var a=this.nodes[r].getChildBySid(e,t);if(a)return a}return null},s.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.nodes=[];for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"node":this.nodes.push((new n).parse(r))}}return this},n.prototype.getChannelForTransform=function(e){for(var t=0;t<this.channels.length;t++){var r,a,i=this.channels[t],s=i.target.split("/"),n=(s.shift(),s.shift()),o=n.indexOf(".")>=0,h=n.indexOf("(")>=0;if(o)s=n.split("."),n=s.shift(),a=s.shift();else if(h){r=n.split("("),n=r.shift();for(var c=0;c<r.length;c++)r[c]=parseInt(r[c].replace(/\)/,""))}if(n===e)return i.info={sid:n,dotSyntax:o,arrSyntax:h,arrIndices:r},i}return null},n.prototype.getChildById=function(e,t){if(this.id===e)return this;if(t)for(var r=0;r<this.nodes.length;r++){var a=this.nodes[r].getChildById(e,t);if(a)return a}return null},n.prototype.getChildBySid=function(e,t){if(this.sid===e)return this;if(t)for(var r=0;r<this.nodes.length;r++){var a=this.nodes[r].getChildBySid(e,t);if(a)return a}return null},n.prototype.getTransformBySid=function(e){for(var t=0;t<this.transforms.length;t++)if(this.transforms[t].sid===e)return this.transforms[t];return null},n.prototype.parse=function(e){var t;this.id=e.getAttribute("id"),this.sid=e.getAttribute("sid"),this.name=e.getAttribute("name"),this.type=e.getAttribute("type"),this.layer=e.getAttribute("layer"),this.type="JOINT"===this.type?this.type:"NODE",this.nodes=[],this.transforms=[],this.geometries=[],this.cameras=[],this.lights=[],this.controllers=[],this.matrix=new a.Matrix4;for(var r=0;r<e.childNodes.length;r++){var i=e.childNodes[r];if(1==i.nodeType)switch(i.nodeName){case"node":this.nodes.push((new n).parse(i));break;case"instance_camera":this.cameras.push((new B).parse(i));break;case"instance_controller":this.controllers.push((new h).parse(i));break;case"instance_geometry":this.geometries.push((new l).parse(i));break;case"instance_light":this.lights.push((new R).parse(i));break;case"instance_node":t=i.getAttribute("url").replace(/^#/,"");var s=ce(t);s&&this.nodes.push((new n).parse(s));break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new o).parse(i));break;case"extra":break;default:console.log(i.nodeName)}}return this.channels=oe(this),$(this),this.updateMatrix(),this},n.prototype.updateMatrix=function(){this.matrix.identity();for(var e=0;e<this.transforms.length;e++)this.transforms[e].apply(this.matrix)},o.prototype.parse=function(e){return this.sid=e.getAttribute("sid"),this.type=e.nodeName,this.data=G(e.textContent),this.convert(),this},o.prototype.convert=function(){switch(this.type){case"matrix":this.obj=se(this.data);break;case"rotate":this.angle=a.Math.degToRad(this.data[3]);case"translate":te(this.data,-1),this.obj=new a.Vector3(this.data[0],this.data[1],this.data[2]);break;case"scale":te(this.data,1),this.obj=new a.Vector3(this.data[0],this.data[1],this.data[2]);break;default:console.log("Can not convert Transform of type "+this.type)}},o.prototype.apply=function(){var e=new a.Matrix4;return function(t){switch(this.type){case"matrix":t.multiply(this.obj);break;case"translate":t.multiply(e.makeTranslation(this.obj.x,this.obj.y,this.obj.z));break;case"rotate":t.multiply(e.makeRotationAxis(this.obj,this.angle));break;case"scale":t.scale(this.obj)}}}(),o.prototype.update=function(e,t){var r=["X","Y","Z","ANGLE"];switch(this.type){case"matrix":if(t)if(1===t.length)switch(t[0]){case 0:this.obj.n11=e[0],this.obj.n21=e[1],this.obj.n31=e[2],this.obj.n41=e[3];break;case 1:this.obj.n12=e[0],this.obj.n22=e[1],this.obj.n32=e[2],this.obj.n42=e[3];break;case 2:this.obj.n13=e[0],this.obj.n23=e[1],this.obj.n33=e[2],this.obj.n43=e[3];break;case 3:this.obj.n14=e[0],this.obj.n24=e[1],this.obj.n34=e[2],this.obj.n44=e[3]}else if(2===t.length){var i="n"+(t[0]+1)+(t[1]+1);this.obj[i]=e}else console.log("Incorrect addressing of matrix in transform.");else this.obj.copy(e);break;case"translate":case"scale":switch("[object Array]"===Object.prototype.toString.call(t)&&(t=r[t[0]]),t){case"X":this.obj.x=e;break;case"Y":this.obj.y=e;break;case"Z":this.obj.z=e;break;default:this.obj.x=e[0],this.obj.y=e[1],this.obj.z=e[2]}break;case"rotate":switch("[object Array]"===Object.prototype.toString.call(t)&&(t=r[t[0]]),t){case"X":this.obj.x=e;break;case"Y":this.obj.y=e;break;case"Z":this.obj.z=e;break;case"ANGLE":this.angle=a.Math.degToRad(e);break;default:this.obj.x=e[0],this.obj.y=e[1],this.obj.z=e[2],this.angle=a.Math.degToRad(e[3])}}},h.prototype.parse=function(e){this.url=e.getAttribute("url").replace(/^#/,""),this.skeleton=[],this.instance_material=[];for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1===r.nodeType)switch(r.nodeName){case"skeleton":this.skeleton.push(r.textContent.replace(/^#/,""));break;case"bind_material":for(var a=r.querySelectorAll("instance_material"),i=0;i<a.length;i++){var s=a[i];this.instance_material.push((new c).parse(s))}break;case"extra":}}return this},c.prototype.parse=function(e){return this.symbol=e.getAttribute("symbol"),this.target=e.getAttribute("target").replace(/^#/,""),this},l.prototype.parse=function(e){this.url=e.getAttribute("url").replace(/^#/,""),this.instance_material=[];for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType&&"bind_material"===r.nodeName){for(var a=r.querySelectorAll("instance_material"),i=0;i<a.length;i++){var s=a[i];this.instance_material.push((new c).parse(s))}break}}return this},d.prototype.parse=function(e){this.id=e.getAttribute("id"),K(this,e);for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];switch(r.nodeName){case"mesh":this.mesh=new u(this).parse(r);break;case"extra":}}return this},u.prototype.parse=function(e){this.primitives=[];for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];switch(r.nodeName){case"source":V(r);break;case"vertices":this.vertices=(new y).parse(r);break;case"linestrips":this.primitives.push((new m).parse(r));break;case"triangles":this.primitives.push((new g).parse(r));break;case"polygons":this.primitives.push((new p).parse(r));break;case"polylist":this.primitives.push((new f).parse(r))}}if(this.geometry3js=new a.Geometry,null===this.vertices)return this;for(var i=Le[this.vertices.input.POSITION.source].data,t=0;t<i.length;t+=3)this.geometry3js.vertices.push(ie(i,t).clone());for(var t=0;t<this.primitives.length;t++){var s=this.primitives[t];s.setVertices(this.vertices),this.handlePrimitive(s,this.geometry3js)}return this.geometry3js.calcNormals&&(this.geometry3js.computeVertexNormals(),delete this.geometry3js.calcNormals),this},u.prototype.handlePrimitive=function(e,t){if(e instanceof m)return void(t.isLineStrip=!0);var r,i,s,n,o,h,c,l=e.p,d=e.inputs,u=0,p=3,f=0,g=[];for(r=0;r<d.length;r++){s=d[r];var v=s.offset+1;switch(f=v>f?v:f,s.semantic){case"TEXCOORD":g.push(s.set)}}for(var y=0;y<l.length;++y)for(var b=l[y],w=0;w<b.length;){var x=[],_=[],A=null,k=[];for(p=e.vcount?e.vcount.length?e.vcount[u++]:e.vcount:b.length/f,r=0;p>r;r++)for(i=0;i<d.length;i++)switch(s=d[i],h=Le[s.source],n=b[w+r*f+s.offset],c=h.accessor.params.length,o=n*c,s.semantic){case"VERTEX":x.push(n);break;case"NORMAL":_.push(ie(h.data,o));break;case"TEXCOORD":A=A||{},void 0===A[s.set]&&(A[s.set]=[]),A[s.set].push(new a.Vector2(h.data[o],h.data[o+1]));break;case"COLOR":k.push((new a.Color).setRGB(h.data[o],h.data[o+1],h.data[o+2]))}if(0===_.length)if(s=this.vertices.input.NORMAL){h=Le[s.source],c=h.accessor.params.length;for(var T=0,M=x.length;M>T;T++)_.push(ie(h.data,x[T]*c))}else t.calcNormals=!0;if(!A&&(A={},s=this.vertices.input.TEXCOORD)){g.push(s.set),h=Le[s.source],c=h.accessor.params.length;for(var T=0,M=x.length;M>T;T++)o=x[T]*c,void 0===A[s.set]&&(A[s.set]=[]),A[s.set].push(new a.Vector2(h.data[o],1-h.data[o+1]))}if(0===k.length&&(s=this.vertices.input.COLOR)){h=Le[s.source],c=h.accessor.params.length;for(var T=0,M=x.length;M>T;T++)o=x[T]*c,k.push((new a.Color).setRGB(h.data[o],h.data[o+1],h.data[o+2]))}var C,L,N=null,U=[];if(3===p)U.push(new a.Face3(x[0],x[1],x[2],_,k.length?k:new a.Color));else if(4===p)U.push(new a.Face3(x[0],x[1],x[3],[_[0].clone(),_[1].clone(),_[3].clone()],k.length?[k[0],k[1],k[3]]:new a.Color)),U.push(new a.Face3(x[1],x[2],x[3],[_[1].clone(),_[2].clone(),_[3].clone()],k.length?[k[1],k[2],k[3]]:new a.Color));else if(p>4&&je.subdivideFaces){var E=k.length?k:new a.Color;for(i=1;p-1>i;)U.push(new a.Face3(x[0],x[i],x[i+1],[_[0].clone(),_[i++].clone(),_[i].clone()],E))}if(U.length)for(var T=0,M=U.length;M>T;T++)for(N=U[T],N.daeMaterial=e.material,t.faces.push(N),i=0;i<g.length;i++)C=A[g[i]],L=p>4?[C[0],C[T+1],C[T+2]]:4===p?0===T?[C[0],C[1],C[3]]:[C[1].clone(),C[2],C[3].clone()]:[C[0],C[1],C[2]],void 0===t.faceVertexUvs[i]&&(t.faceVertexUvs[i]=[]),t.faceVertexUvs[i].push(L);else console.log("dropped face with vcount "+p+" for geometry with id: "+t.id);w+=f*p}},p.prototype.setVertices=function(e){for(var t=0;t<this.inputs.length;t++)this.inputs[t].source===e.id&&(this.inputs[t].source=e.input.POSITION.source)},p.prototype.parse=function(e){this.material=e.getAttribute("material"),this.count=X(e,"count",0);for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];switch(r.nodeName){case"input":this.inputs.push((new b).parse(e.childNodes[t]));break;case"vcount":this.vcount=H(r.textContent);break;case"p":this.p.push(H(r.textContent));break;case"ph":console.warn("polygon holes not yet supported!")}}return this},f.prototype=Object.create(p.prototype),f.prototype.constructor=f,m.prototype=Object.create(p.prototype),m.prototype.constructor=m,g.prototype=Object.create(p.prototype),g.prototype.constructor=g,v.prototype.parse=function(e){this.params=[],this.source=e.getAttribute("source"),this.count=X(e,"count",0),this.stride=X(e,"stride",0);for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if("param"===r.nodeName){var a={};a.name=r.getAttribute("name"),a.type=r.getAttribute("type"),this.params.push(a)}}return this},y.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++)if("input"===e.childNodes[t].nodeName){var r=(new b).parse(e.childNodes[t]);this.input[r.semantic]=r}return this},b.prototype.parse=function(e){return this.semantic=e.getAttribute("semantic"),this.source=e.getAttribute("source").replace(/^#/,""),this.set=X(e,"set",-1),this.offset=X(e,"offset",0),"TEXCOORD"===this.semantic&&this.set<0&&(this.set=0),this},w.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];switch(r.nodeName){case"bool_array":this.data=j(r.textContent),this.type=r.nodeName;break;case"float_array":this.data=G(r.textContent),this.type=r.nodeName;break;case"int_array":this.data=H(r.textContent),this.type=r.nodeName;break;case"IDREF_array":case"Name_array":this.data=q(r.textContent),this.type=r.nodeName;break;case"technique_common":for(var a=0;a<r.childNodes.length;a++)if("accessor"===r.childNodes[a].nodeName){this.accessor=(new v).parse(r.childNodes[a]);break}}}return this},w.prototype.read=function(){var e=[],t=this.accessor.params[0];switch(t.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(var r=0;r<this.data.length;r+=16){var a=this.data.slice(r,r+16),i=se(a);e.push(i)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+t.type+".")}return e},x.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++)if("instance_effect"===e.childNodes[t].nodeName){this.instance_effect=(new C).parse(e.childNodes[t]);break}return this},_.prototype.isColor=function(){return null===this.texture},_.prototype.isTexture=function(){return null!=this.texture},_.prototype.parse=function(e){"transparent"===e.nodeName&&(this.opaque=e.getAttribute("opaque"));for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"color":var i=G(r.textContent);this.color=new a.Color,this.color.setRGB(i[0],i[1],i[2]),this.color.a=i[3];break;case"texture":this.texture=r.getAttribute("texture"),this.texcoord=r.getAttribute("texcoord"),this.texOpts={offsetU:0,offsetV:0,repeatU:1,repeatV:1,wrapU:1,wrapV:1},this.parseTexture(r)}}return this},_.prototype.parseTexture=function(e){if(!e.childNodes)return this;e.childNodes[1]&&"extra"===e.childNodes[1].nodeName&&(e=e.childNodes[1],e.childNodes[1]&&"technique"===e.childNodes[1].nodeName&&(e=e.childNodes[1]));for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];switch(r.nodeName){case"offsetU":case"offsetV":case"repeatU":case"repeatV":this.texOpts[r.nodeName]=parseFloat(r.textContent);break;case"wrapU":case"wrapV":"TRUE"===r.textContent.toUpperCase()?this.texOpts[r.nodeName]=1:this.texOpts[r.nodeName]=parseInt(r.textContent);break;default:this.texOpts[r.nodeName]=r.textContent}}return this},A.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"emission":case"diffuse":case"specular":case"transparent":this[r.nodeName]=(new _).parse(r);break;case"bump":var a=r.getAttribute("bumptype");a?"heightfield"===a.toLowerCase()?this.bump=(new _).parse(r):"normalmap"===a.toLowerCase()?this.normal=(new _).parse(r):(console.error("Shader.prototype.parse: Invalid value for attribute 'bumptype' ("+a+") - valid bumptypes are 'HEIGHTFIELD' and 'NORMALMAP' - defaulting to 'HEIGHTFIELD'"),this.bump=(new _).parse(r)):(console.warn("Shader.prototype.parse: Attribute 'bumptype' missing from bump node - defaulting to 'HEIGHTFIELD'"),this.bump=(new _).parse(r));break;case"shininess":case"reflectivity":case"index_of_refraction":case"transparency":var i=r.querySelectorAll("float");i.length>0&&(this[r.nodeName]=parseFloat(i[0].textContent))}}return this.create(),this},A.prototype.create=function(){var e={},t=!1;if(void 0!==this.transparency&&void 0!==this.transparent){var r=(this.transparent,(this.transparent.color.r+this.transparent.color.g+this.transparent.color.b)/3*this.transparency);r>0&&(t=!0,e.transparent=!0,e.opacity=1-r)}var i={diffuse:"map",ambient:"lightMap",specular:"specularMap",emission:"emissionMap",bump:"bumpMap",normal:"normalMap"};for(var s in this)switch(s){case"ambient":case"emission":case"diffuse":case"specular":case"bump":case"normal":var n=this[s];if(n instanceof _)if(n.isTexture()){var o=n.texture,h=this.effect.sampler[o];if(void 0!==h&&void 0!==h.source){var c=this.effect.surface[h.source];if(void 0!==c){var l=Ne[c.init_from];if(l&&Ae){var d,u=Ae+l.init_from,p=a.Loader.Handlers.get(u);null!==p?d=p.load(u):(d=new a.Texture,Y(d,u)),d.wrapS=n.texOpts.wrapU?a.RepeatWrapping:a.ClampToEdgeWrapping,d.wrapT=n.texOpts.wrapV?a.RepeatWrapping:a.ClampToEdgeWrapping,d.offset.x=n.texOpts.offsetU,d.offset.y=n.texOpts.offsetV,d.repeat.x=n.texOpts.repeatU,d.repeat.y=n.texOpts.repeatV,e[i[s]]=d,"emission"===s&&(e.emissive=16777215)}}}}else"diffuse"!==s&&t||("emission"===s?e.emissive=n.color.getHex():e[s]=n.color.getHex());break;case"shininess":e[s]=this[s];break;case"reflectivity":e[s]=this[s],e[s]>0&&(e.envMap=je.defaultEnvMap),e.combine=a.MixOperation;break;case"index_of_refraction":e.refractionRatio=this[s],1!==this[s]&&(e.envMap=je.defaultEnvMap);break;case"transparency":}switch(e.shading=Ie,e.side=this.effect.doubleSided?a.DoubleSide:a.FrontSide,this.type){case"constant":void 0!=e.emissive&&(e.color=e.emissive),this.material=new a.MeshBasicMaterial(e);break;case"phong":case"blinn":void 0!=e.diffuse&&(e.color=e.diffuse),this.material=new a.MeshPhongMaterial(e);break;case"lambert":default:void 0!=e.diffuse&&(e.color=e.diffuse),this.material=new a.MeshLambertMaterial(e)}return this.material},k.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"init_from":this.init_from=r.textContent;break;case"format":this.format=r.textContent;break;default:console.log("unhandled Surface prop: "+r.nodeName)}}return this},T.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"source":this.source=r.textContent;break;case"minfilter":this.minfilter=r.textContent;break;case"magfilter":this.magfilter=r.textContent;break;case"mipfilter":this.mipfilter=r.textContent;break;case"wrap_s":this.wrap_s=r.textContent;break;case"wrap_t":this.wrap_t=r.textContent;break;default:console.log("unhandled Sampler2D prop: "+r.nodeName);
}}return this},M.prototype.create=function(){return null===this.shader?null:void 0},M.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),K(this,e),this.shader=null;for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(r))}}return this},M.prototype.parseNewparam=function(e){for(var t=e.getAttribute("sid"),r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1==a.nodeType)switch(a.nodeName){case"surface":this.surface[t]=new k(this).parse(a);break;case"sampler2D":this.sampler[t]=new T(this).parse(a);break;case"extra":break;default:console.log(a.nodeName)}}},M.prototype.parseProfileCOMMON=function(t){for(var r,a=0;a<t.childNodes.length;a++){var i=t.childNodes[a];if(1==i.nodeType)switch(i.nodeName){case"profile_COMMON":this.parseProfileCOMMON(i);break;case"technique":r=i;break;case"newparam":this.parseNewparam(i);break;case"image":var s=(new e).parse(i);Ne[s.id]=s;break;case"extra":break;default:console.log(i.nodeName)}}return r},M.prototype.parseTechnique=function(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"constant":case"lambert":case"blinn":case"phong":this.shader=new A(r.nodeName,this).parse(r);break;case"extra":this.parseExtra(r)}}},M.prototype.parseExtra=function(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"technique":this.parseExtraTechnique(r)}}},M.prototype.parseExtraTechnique=function(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"bump":this.shader.parse(e)}}},C.prototype.parse=function(e){return this.url=e.getAttribute("url").replace(/^#/,""),this},L.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.source={};for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"animation":var a=(new L).parse(r);for(var i in a.source)this.source[i]=a.source[i];for(var s=0;s<a.channel.length;s++)this.channel.push(a.channel[s]),this.sampler.push(a.sampler[s]);break;case"source":var i=(new w).parse(r);this.source[i.id]=i;break;case"sampler":this.sampler.push(new U(this).parse(r));break;case"channel":this.channel.push(new N(this).parse(r))}}return this},N.prototype.parse=function(e){this.source=e.getAttribute("source").replace(/^#/,""),this.target=e.getAttribute("target");var t=this.target.split("/"),r=(t.shift(),t.shift()),a=r.indexOf(".")>=0,i=r.indexOf("(")>=0;if(a)t=r.split("."),this.sid=t.shift(),this.member=t.shift();else if(i){var s=r.split("(");this.sid=s.shift();for(var n=0;n<s.length;n++)s[n]=parseInt(s[n].replace(/\)/,""));this.arrIndices=s}else this.sid=r;return this.fullSid=r,this.dotSyntax=a,this.arrSyntax=i,this},U.prototype.parse=function(e){this.id=e.getAttribute("id"),this.inputs=[];for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"input":this.inputs.push((new b).parse(r))}}return this},U.prototype.create=function(){for(var e=0;e<this.inputs.length;e++){var t=this.inputs[e],r=this.animation.source[t.source];switch(t.semantic){case"INPUT":this.input=r.read();break;case"OUTPUT":this.output=r.read(),this.strideOut=r.accessor.stride;break;case"INTERPOLATION":this.interpolation=r.read();break;case"IN_TANGENT":break;case"OUT_TANGENT":break;default:console.log(t.semantic)}}if(this.startTime=0,this.endTime=0,this.duration=0,this.input.length){this.startTime=1e8,this.endTime=-1e8;for(var e=0;e<this.input.length;e++)this.startTime=Math.min(this.startTime,this.input[e]),this.endTime=Math.max(this.endTime,this.input[e]);this.duration=this.endTime-this.startTime}},U.prototype.getData=function(e,t,r){var a;if("matrix"===e&&16===this.strideOut)a=this.output[t];else if(this.strideOut>1){a=[],t*=this.strideOut;for(var i=0;i<this.strideOut;++i)a[i]=this.output[t+i];if(3===this.strideOut)switch(e){case"rotate":case"translate":te(a,-1);break;case"scale":te(a,1)}else 4===this.strideOut&&"matrix"===e&&te(a,-1)}else a=this.output[t],r&&"translate"===e&&(a=ae(r,a));return a},E.prototype.addTarget=function(e,t,r,a){this.targets.push({sid:e,member:r,transform:t,data:a})},E.prototype.apply=function(e){for(var t=0;t<this.targets.length;++t){var r=this.targets[t];e&&r.sid!==e||r.transform.update(r.data,r.member)}},E.prototype.getTarget=function(e){for(var t=0;t<this.targets.length;++t)if(this.targets[t].sid===e)return this.targets[t];return null},E.prototype.hasTarget=function(e){for(var t=0;t<this.targets.length;++t)if(this.targets[t].sid===e)return!0;return!1},E.prototype.interpolate=function(e,t){for(var r=0,a=this.targets.length;a>r;r++){var i,s=this.targets[r],n=e.getTarget(s.sid);if("matrix"!==s.transform.type&&n){var o=(t-this.time)/(e.time-this.time),h=n.data,c=s.data;if(0>o&&(o=0),o>1&&(o=1),c.length){i=[];for(var l=0;l<c.length;++l)i[l]=c[l]+(h[l]-c[l])*o}else i=c+(h-c)*o}else i=s.data;s.transform.update(i,s.member)}},F.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"optics":this.parseOptics(r)}}return this},F.prototype.parseOptics=function(e){for(var t=0;t<e.childNodes.length;t++)if("technique_common"===e.childNodes[t].nodeName)for(var r=e.childNodes[t],a=0;a<r.childNodes.length;a++)if(this.technique=r.childNodes[a].nodeName,"perspective"===this.technique)for(var i=r.childNodes[a],s=0;s<i.childNodes.length;s++){var n=i.childNodes[s];switch(n.nodeName){case"yfov":this.yfov=n.textContent;break;case"xfov":this.xfov=n.textContent;break;case"znear":this.znear=n.textContent;break;case"zfar":this.zfar=n.textContent;break;case"aspect_ratio":this.aspect_ratio=n.textContent}}else if("orthographic"===this.technique)for(var o=r.childNodes[a],s=0;s<o.childNodes.length;s++){var n=o.childNodes[s];switch(n.nodeName){case"xmag":this.xmag=n.textContent;break;case"ymag":this.ymag=n.textContent;break;case"znear":this.znear=n.textContent;break;case"zfar":this.zfar=n.textContent;break;case"aspect_ratio":this.aspect_ratio=n.textContent}}return this},B.prototype.parse=function(e){return this.url=e.getAttribute("url").replace(/^#/,""),this},O.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"technique_common":this.parseCommon(r);break;case"technique":this.parseTechnique(r)}}return this},O.prototype.parseCommon=function(e){for(var t=0;t<e.childNodes.length;t++)switch(e.childNodes[t].nodeName){case"directional":case"point":case"spot":case"ambient":this.technique=e.childNodes[t].nodeName;for(var r=e.childNodes[t],i=0;i<r.childNodes.length;i++){var s=r.childNodes[i];switch(s.nodeName){case"color":var n=G(s.textContent);this.color=new a.Color(0),this.color.setRGB(n[0],n[1],n[2]),this.color.a=n[3];break;case"falloff_angle":this.falloff_angle=parseFloat(s.textContent);break;case"quadratic_attenuation":var o=parseFloat(s.textContent);this.distance=o?Math.sqrt(1/o):0}}}return this},O.prototype.parseTechnique=function(e){this.profile=e.getAttribute("profile");for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];switch(r.nodeName){case"intensity":this.intensity=parseFloat(r.textContent)}}return this},R.prototype.parse=function(e){return this.url=e.getAttribute("url").replace(/^#/,""),this},S.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.joints=[],this.links=[];for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"technique_common":this.parseCommon(r)}}return this},S.prototype.parseCommon=function(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(e.childNodes[t].nodeName){case"joint":this.joints.push((new I).parse(r));break;case"link":this.links.push((new P).parse(r))}}return this},I.prototype.parse=function(e){this.sid=e.getAttribute("sid"),this.name=e.getAttribute("name"),this.axis=new a.Vector3,this.limits={min:0,max:0},this.type="",this["static"]=!1,this.zeroPosition=0,this.middlePosition=0;var t=e.querySelector("axis"),r=G(t.textContent);this.axis=ie(r,0);var i=e.querySelector("limits min")?parseFloat(e.querySelector("limits min").textContent):-360,s=e.querySelector("limits max")?parseFloat(e.querySelector("limits max").textContent):360;this.limits={min:i,max:s};for(var n=["prismatic","revolute"],o=0;o<n.length;o++){var h=n[o],c=e.querySelector(h);c&&(this.type=h)}return this.limits.min>=this.limits.max&&(this["static"]=!0),this.middlePosition=(this.limits.min+this.limits.max)/2,this},P.prototype.parse=function(e){this.sid=e.getAttribute("sid"),this.name=e.getAttribute("name"),this.transforms=[],this.attachments=[];for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"attachment_full":this.attachments.push((new D).parse(r));break;case"rotate":case"translate":case"matrix":this.transforms.push((new o).parse(r))}}return this},D.prototype.parse=function(e){this.joint=e.getAttribute("joint").split("/").pop(),this.links=[];for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"link":this.links.push((new P).parse(r));break;case"rotate":case"translate":case"matrix":this.transforms.push((new o).parse(r))}}return this}}()},function(e,t,r){var a=r(1);a.DDSLoader=function(){this._parser=a.DDSLoader.parse},a.DDSLoader.prototype=Object.create(a.CompressedTextureLoader.prototype),a.DDSLoader.prototype.constructor=a.DDSLoader,a.DDSLoader.parse=function(e,t){function r(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function i(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}function s(e,t,r,a){for(var i=r*a*4,s=new Uint8Array(e,t,i),n=new Uint8Array(i),o=0,h=0,c=0;a>c;c++)for(var l=0;r>l;l++){var d=s[h];h++;var u=s[h];h++;var p=s[h];h++;var f=s[h];h++,n[o]=p,o++,n[o]=u,o++,n[o]=d,o++,n[o]=f,o++}return n}var n={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},o=542327876,h=131072,c=512,l=1024,d=2048,u=4096,p=8192,f=16384,m=32768,g=4,v=r("DXT1"),y=r("DXT3"),b=r("DXT5"),w=31,x=0,_=1,A=2,k=3,T=4,M=7,C=20,L=21,N=22,U=23,E=24,F=25,B=26,O=28,R=new Int32Array(e,0,w);if(R[x]!==o)return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),n;if(!R[C]&g)return console.error("THREE.DDSLoader.parse: Unsupported format, must contain a FourCC code."),n;var S,I=R[L],P=!1;switch(I){case v:S=8,n.format=a.RGB_S3TC_DXT1_Format;break;case y:S=16,n.format=a.RGBA_S3TC_DXT3_Format;break;case b:S=16,n.format=a.RGBA_S3TC_DXT5_Format;break;default:if(!(32===R[N]&&16711680&R[U]&&65280&R[E]&&255&R[F]&&4278190080&R[B]))return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",i(I)),n;P=!0,S=64,n.format=a.RGBAFormat}n.mipmapCount=1,R[A]&h&&t!==!1&&(n.mipmapCount=Math.max(1,R[M]));var D=R[O];if(n.isCubemap=!!(D&c),n.isCubemap&&(!(D&l)||!(D&d)||!(D&u)||!(D&p)||!(D&f)||!(D&m)))return console.error("THREE.DDSLoader.parse: Incomplete cubemap faces"),n;n.width=R[T],n.height=R[k];for(var V=R[_]+4,j=n.isCubemap?6:1,G=0;j>G;G++)for(var H=n.width,q=n.height,z=0;z<n.mipmapCount;z++){if(P)var X=s(e,V,H,q),Y=X.length;else var Y=Math.max(4,H)/4*Math.max(4,q)/4*S,X=new Uint8Array(e,V,Y);var W={data:X,width:H,height:q};n.mipmaps.push(W),V+=Y,H=Math.max(H>>1,1),q=Math.max(q>>1,1)}return n}},function(e,t,r){var a=r(1);r(11);a.MD2CharacterLoader=function(){},a.MD2CharacterLoader.prototype={constructor:a.MD2CharacterLoader,load:function(e,t,r,i){var s=new a.MD2Character;s.onLoadComplete=function(){t&&t(s)},s.loadParts(e)}}},function(e,t,r){var a=r(1);a.MD2Character=function(){function e(e,t){for(var i=a.UVMapping,s=[],n=0;n<t.length;n++)s[n]=a.ImageUtils.loadTexture(e+t[n],i,r),s[n].name=t[n];return s}function t(e,t){var r=new a.MeshLambertMaterial({color:16755200,wireframe:!0,morphTargets:!0,morphNormals:!0}),i=new a.MeshLambertMaterial({color:16777215,wireframe:!1,map:t,morphTargets:!0,morphNormals:!0}),s=new a.Mesh(e,i);return s.rotation.y=-Math.PI/2,s.castShadow=!0,s.receiveShadow=!0,s.materialTexture=i,s.materialWireframe=r,s}function r(){i.loadCounter-=1,0===i.loadCounter&&i.onLoadComplete()}var i=this;this.scale=1,this.animationFPS=6,this.root=new a.Object3D,this.meshBody=null,this.meshWeapon=null,this.skinsBody=[],this.skinsWeapon=[],this.weapons=[],this.activeAnimation=null,this.mixer=null,this.onLoadComplete=function(){},this.loadCounter=0,this.loadParts=function(s){this.loadCounter=2*s.weapons.length+s.skins.length+1;for(var n=[],o=0;o<s.weapons.length;o++)n[o]=s.weapons[o][1];this.skinsBody=e(s.baseUrl+"skins/",s.skins),this.skinsWeapon=e(s.baseUrl+"skins/",n);var h=new a.MD2Loader;h.load(s.baseUrl+s.body,function(e){e.computeBoundingBox(),i.root.position.y=-i.scale*e.boundingBox.min.y;var s=t(e,i.skinsBody[0]);s.scale.set(i.scale,i.scale,i.scale),i.root.add(s),i.meshBody=s,i.meshBody.clipOffset=0,i.activeAnimationClipName=s.geometry.animations[0].name,i.mixer=new a.AnimationMixer(s),r()});for(var c=function(e,a){return function(s){var n=t(s,i.skinsWeapon[e]);n.scale.set(i.scale,i.scale,i.scale),n.visible=!1,n.name=a,i.root.add(n),i.weapons[e]=n,i.meshWeapon=n,r()}},o=0;o<s.weapons.length;o++)h.load(s.baseUrl+s.weapons[o][0],c(o,s.weapons[o][0]))},this.setPlaybackRate=function(e){0!==e?this.mixer.timeScale=1/e:this.mixer.timeScale=0},this.setWireframe=function(e){e?(this.meshBody&&(this.meshBody.material=this.meshBody.materialWireframe),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialWireframe)):(this.meshBody&&(this.meshBody.material=this.meshBody.materialTexture),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialTexture))},this.setSkin=function(e){this.meshBody&&this.meshBody.material.wireframe===!1&&(this.meshBody.material.map=this.skinsBody[e])},this.setWeapon=function(e){for(var t=0;t<this.weapons.length;t++)this.weapons[t].visible=!1;var r=this.weapons[e];r&&(r.visible=!0,this.meshWeapon=r,i.syncWeaponAnimation())},this.setAnimation=function(e){if(this.meshBody){this.meshBody.activeAction&&(i.mixer.removeAction(this.meshBody.activeAction),this.meshBody.activeAction=null);var t=a.AnimationClip.findByName(this.meshBody.geometry.animations,e);if(t){var r=new a.AnimationAction(t,this.mixer.time).setLocalRoot(this.meshBody);i.mixer.addAction(r),this.meshBody.activeAction=r}}i.activeClipName=e,i.syncWeaponAnimation()},this.syncWeaponAnimation=function(){var e=i.activeClipName;if(i.meshWeapon){this.meshWeapon.activeAction&&(i.mixer.removeAction(this.meshWeapon.activeAction),this.meshWeapon.activeAction=null);var t=a.AnimationClip.findByName(this.meshWeapon.geometry.animations,e);if(t){var r=new a.AnimationAction(t).syncWith(this.meshBody.activeAction).setLocalRoot(this.meshWeapon);i.mixer.addAction(r),this.meshWeapon.activeAction=r}}},this.update=function(e){this.mixer&&this.mixer.update(e)}},e.exports=a.MD2Character},function(e,t,r){var a=r(1);a.MD2Loader=function(e){this.manager=void 0!==e?e:a.DefaultLoadingManager},a.MD2Loader.prototype={constructor:a.MD2Loader,load:function(e,t,r,i){var s=this,n=new a.XHRLoader(s.manager);n.setCrossOrigin(this.crossOrigin),n.setResponseType("arraybuffer"),n.load(e,function(e){t(s.parse(e))},r,i)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(){var e=[[-.525731,0,.850651],[-.442863,.238856,.864188],[-.295242,0,.955423],[-.309017,.5,.809017],[-.16246,.262866,.951056],[0,0,1],[0,.850651,.525731],[-.147621,.716567,.681718],[.147621,.716567,.681718],[0,.525731,.850651],[.309017,.5,.809017],[.525731,0,.850651],[.295242,0,.955423],[.442863,.238856,.864188],[.16246,.262866,.951056],[-.681718,.147621,.716567],[-.809017,.309017,.5],[-.587785,.425325,.688191],[-.850651,.525731,0],[-.864188,.442863,.238856],[-.716567,.681718,.147621],[-.688191,.587785,.425325],[-.5,.809017,.309017],[-.238856,.864188,.442863],[-.425325,.688191,.587785],[-.716567,.681718,-.147621],[-.5,.809017,-.309017],[-.525731,.850651,0],[0,.850651,-.525731],[-.238856,.864188,-.442863],[0,.955423,-.295242],[-.262866,.951056,-.16246],[0,1,0],[0,.955423,.295242],[-.262866,.951056,.16246],[.238856,.864188,.442863],[.262866,.951056,.16246],[.5,.809017,.309017],[.238856,.864188,-.442863],[.262866,.951056,-.16246],[.5,.809017,-.309017],[.850651,.525731,0],[.716567,.681718,.147621],[.716567,.681718,-.147621],[.525731,.850651,0],[.425325,.688191,.587785],[.864188,.442863,.238856],[.688191,.587785,.425325],[.809017,.309017,.5],[.681718,.147621,.716567],[.587785,.425325,.688191],[.955423,.295242,0],[1,0,0],[.951056,.16246,.262866],[.850651,-.525731,0],[.955423,-.295242,0],[.864188,-.442863,.238856],[.951056,-.16246,.262866],[.809017,-.309017,.5],[.681718,-.147621,.716567],[.850651,0,.525731],[.864188,.442863,-.238856],[.809017,.309017,-.5],[.951056,.16246,-.262866],[.525731,0,-.850651],[.681718,.147621,-.716567],[.681718,-.147621,-.716567],[.850651,0,-.525731],[.809017,-.309017,-.5],[.864188,-.442863,-.238856],[.951056,-.16246,-.262866],[.147621,.716567,-.681718],[.309017,.5,-.809017],[.425325,.688191,-.587785],[.442863,.238856,-.864188],[.587785,.425325,-.688191],[.688191,.587785,-.425325],[-.147621,.716567,-.681718],[-.309017,.5,-.809017],[0,.525731,-.850651],[-.525731,0,-.850651],[-.442863,.238856,-.864188],[-.295242,0,-.955423],[-.16246,.262866,-.951056],[0,0,-1],[.295242,0,-.955423],[.16246,.262866,-.951056],[-.442863,-.238856,-.864188],[-.309017,-.5,-.809017],[-.16246,-.262866,-.951056],[0,-.850651,-.525731],[-.147621,-.716567,-.681718],[.147621,-.716567,-.681718],[0,-.525731,-.850651],[.309017,-.5,-.809017],[.442863,-.238856,-.864188],[.16246,-.262866,-.951056],[.238856,-.864188,-.442863],[.5,-.809017,-.309017],[.425325,-.688191,-.587785],[.716567,-.681718,-.147621],[.688191,-.587785,-.425325],[.587785,-.425325,-.688191],[0,-.955423,-.295242],[0,-1,0],[.262866,-.951056,-.16246],[0,-.850651,.525731],[0,-.955423,.295242],[.238856,-.864188,.442863],[.262866,-.951056,.16246],[.5,-.809017,.309017],[.716567,-.681718,.147621],[.525731,-.850651,0],[-.238856,-.864188,-.442863],[-.5,-.809017,-.309017],[-.262866,-.951056,-.16246],[-.850651,-.525731,0],[-.716567,-.681718,-.147621],[-.716567,-.681718,.147621],[-.525731,-.850651,0],[-.5,-.809017,.309017],[-.238856,-.864188,.442863],[-.262866,-.951056,.16246],[-.864188,-.442863,.238856],[-.809017,-.309017,.5],[-.688191,-.587785,.425325],[-.681718,-.147621,.716567],[-.442863,-.238856,.864188],[-.587785,-.425325,.688191],[-.309017,-.5,.809017],[-.147621,-.716567,.681718],[-.425325,-.688191,.587785],[-.16246,-.262866,.951056],[.442863,-.238856,.864188],[.16246,-.262866,.951056],[.309017,-.5,.809017],[.147621,-.716567,.681718],[0,-.525731,.850651],[.425325,-.688191,.587785],[.587785,-.425325,.688191],[.688191,-.587785,.425325],[-.955423,.295242,0],[-.951056,.16246,.262866],[-1,0,0],[-.850651,0,.525731],[-.955423,-.295242,0],[-.951056,-.16246,.262866],[-.864188,.442863,-.238856],[-.951056,.16246,-.262866],[-.809017,.309017,-.5],[-.864188,-.442863,-.238856],[-.951056,-.16246,-.262866],[-.809017,-.309017,-.5],[-.681718,.147621,-.716567],[-.681718,-.147621,-.716567],[-.850651,0,-.525731],[-.688191,.587785,-.425325],[-.587785,.425325,-.688191],[-.425325,.688191,-.587785],[-.425325,-.688191,-.587785],[-.587785,-.425325,-.688191],[-.688191,-.587785,-.425325]];return function(t){console.time("MD2Loader");for(var r=new DataView(t),i={},s=["ident","version","skinwidth","skinheight","framesize","num_skins","num_vertices","num_st","num_tris","num_glcmds","num_frames","offset_skins","offset_st","offset_tris","offset_frames","offset_glcmds","offset_end"],n=0;n<s.length;n++)i[s[n]]=r.getInt32(4*n,!0);if(844121161!==i.ident||8!==i.version)return void console.error("Not a valid MD2 file");if(i.offset_end!==r.byteLength)return void console.error("Corrupted MD2 file");for(var o=new a.Geometry,h=[],c=i.offset_st,n=0,l=i.num_st;l>n;n++){var d=r.getInt16(c+0,!0),u=r.getInt16(c+2,!0);h.push(new a.Vector2(d/i.skinwidth,1-u/i.skinheight)),c+=4}for(var c=i.offset_tris,n=0,l=i.num_tris;l>n;n++){var p=r.getUint16(c+0,!0),f=r.getUint16(c+2,!0),m=r.getUint16(c+4,!0);o.faces.push(new a.Face3(p,f,m)),o.faceVertexUvs[0].push([h[r.getUint16(c+6,!0)],h[r.getUint16(c+8,!0)],h[r.getUint16(c+10,!0)]]),c+=12}for(var g=new a.Vector3,v=new a.Vector3,y=[],c=i.offset_frames,n=0,l=i.num_frames;l>n;n++){v.set(r.getFloat32(c+0,!0),r.getFloat32(c+4,!0),r.getFloat32(c+8,!0)),g.set(r.getFloat32(c+12,!0),r.getFloat32(c+16,!0),r.getFloat32(c+20,!0)),c+=24;for(var b=0;16>b;b++){var w=r.getUint8(c+b,!0);if(0===w)break;y[b]=w}var x={name:String.fromCharCode.apply(null,y),vertices:[],normals:[]};c+=16;for(var b=0;b<i.num_vertices;b++){var _=r.getUint8(c++,!0),A=r.getUint8(c++,!0),k=r.getUint8(c++,!0),T=e[r.getUint8(c++,!0)],M=new a.Vector3(_*v.x+g.x,k*v.z+g.z,A*v.y+g.y),C=new a.Vector3(T[0],T[2],T[1]);x.vertices.push(M),x.normals.push(C)}o.morphTargets.push(x)}o.vertices=o.morphTargets[0].vertices;for(var L=o.morphTargets[0],b=0,N=o.faces.length;N>b;b++){var U=o.faces[b];U.vertexNormals=[L.normals[U.a],L.normals[U.b],L.normals[U.c]]}for(var n=0,l=o.morphTargets.length;l>n;n++){for(var L=o.morphTargets[n],E=[],b=0,N=o.faces.length;N>b;b++){var U=o.faces[b];E.push({a:L.normals[U.a],b:L.normals[U.b],c:L.normals[U.c]})}o.morphNormals.push({vertexNormals:E})}return o.animations=a.AnimationClip.CreateClipsFromMorphTargetSequences(o.morphTargets,10),console.timeEnd("MD2Loader"),o}}()}},function(e,t,r){var a=r(1);a.MTLLoader=function(e){this.manager=void 0!==e?e:a.DefaultLoadingManager},a.MTLLoader.prototype={constructor:a.MTLLoader,load:function(e,t,r,i){var s=this,n=new a.XHRLoader(this.manager);n.setCrossOrigin(this.crossOrigin),n.load(e,function(e){t(s.parse(e))},r,i)},setBaseUrl:function(e){this.baseUrl=e},setCrossOrigin:function(e){this.crossOrigin=e},setMaterialOptions:function(e){this.materialOptions=e},parse:function(e){for(var t=e.split("\n"),r={},i=/\s+/,s={},n=0;n<t.length;n++){var o=t[n];if(o=o.trim(),0!==o.length&&"#"!==o.charAt(0)){var h=o.indexOf(" "),c=h>=0?o.substring(0,h):o;c=c.toLowerCase();var l=h>=0?o.substring(h+1):"";if(l=l.trim(),"newmtl"===c)r={name:l},s[l]=r;else if(r)if("ka"===c||"kd"===c||"ks"===c){var d=l.split(i,3);r[c]=[parseFloat(d[0]),parseFloat(d[1]),parseFloat(d[2])]}else r[c]=l}}var u=new a.MTLLoader.MaterialCreator(this.baseUrl,this.materialOptions);return u.setCrossOrigin(this.crossOrigin),u.setManager(this.manager),u.setMaterials(s),u}},a.MTLLoader.MaterialCreator=function(e,t){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:a.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:a.RepeatWrapping},a.MTLLoader.MaterialCreator.prototype={constructor:a.MTLLoader.MaterialCreator,setCrossOrigin:function(e){this.crossOrigin=e},setManager:function(e){this.manager=e},setMaterials:function(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(e){if(!this.options)return e;var t={};for(var r in e){var a=e[r],i={};t[r]=i;for(var s in a){var n=!0,o=a[s],h=s.toLowerCase();switch(h){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(o=[o[0]/255,o[1]/255,o[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===o[0]&&0===o[1]&&0===o[1]&&(n=!1);break;case"d":this.options&&this.options.invertTransparency&&(o=1-o)}n&&(i[h]=o)}}return t},preload:function(){for(var e in this.materialsInfo)this.create(e)},getIndex:function(e){return this.nameLookup[e]},getAsArray:function(){var e=0;for(var t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray},create:function(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]},createMaterial_:function(e){var t=this.materialsInfo[e],r={name:e,side:this.side};for(var i in t){var s=t[i];switch(i.toLowerCase()){case"kd":r.diffuse=(new a.Color).fromArray(s);break;case"ka":break;case"ks":r.specular=(new a.Color).fromArray(s);break;case"map_kd":r.map=this.loadTexture(this.baseUrl+s),r.map.wrapS=this.wrap,r.map.wrapT=this.wrap;break;case"ns":r.shininess=s;break;case"d":1>s&&(r.transparent=!0,r.opacity=s);break;case"map_bump":case"bump":if(r.bumpMap)break;r.bumpMap=this.loadTexture(this.baseUrl+s),r.bumpMap.wrapS=this.wrap,r.bumpMap.wrapT=this.wrap}}return r.diffuse&&(r.color=r.diffuse),this.materials[e]=new a.MeshPhongMaterial(r),this.materials[e]},loadTexture:function(e,t,r,i,s){var n,o=a.Loader.Handlers.get(e),h=void 0!==this.manager?this.manager:a.DefaultLoadingManager;return null!==o?n=o.load(e,r):(n=new a.Texture,o=new a.ImageLoader(h),o.setCrossOrigin(this.crossOrigin),o.load(e,function(e){n.image=a.MTLLoader.ensurePowerOfTwo_(e),n.needsUpdate=!0,r&&r(n)},i,s)),void 0!==t&&(n.mapping=t),n}},a.MTLLoader.ensurePowerOfTwo_=function(e){if(!a.Math.isPowerOfTwo(e.width)||!a.Math.isPowerOfTwo(e.height)){var t=document.createElement("canvas");t.width=a.MTLLoader.nextHighestPowerOfTwo_(e.width),t.height=a.MTLLoader.nextHighestPowerOfTwo_(e.height);var r=t.getContext("2d");return r.drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),t}return e},a.MTLLoader.nextHighestPowerOfTwo_=function(e){--e;for(var t=1;32>t;t<<=1)e|=e>>t;return e+1},a.EventDispatcher.prototype.apply(a.MTLLoader.prototype)},function(e,t,r){var a=r(1);a.OBJLoader=function(e){this.manager=void 0!==e?e:a.DefaultLoadingManager},a.OBJLoader.prototype={constructor:a.OBJLoader,load:function(e,t,r,i){var s=this,n=new a.XHRLoader(s.manager);n.setCrossOrigin(this.crossOrigin),n.load(e,function(e){t(s.parse(e))},r,i)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){function t(e){var t=parseInt(e);return 3*(t>=0?t-1:t+p.length/3)}function r(e){var t=parseInt(e);return 3*(t>=0?t-1:t+f.length/3)}function i(e){var t=parseInt(e);return 2*(t>=0?t-1:t+m.length/2)}function s(e,t,r){l.vertices.push(p[e],p[e+1],p[e+2],p[t],p[t+1],p[t+2],p[r],p[r+1],p[r+2])}function n(e,t,r){l.normals.push(f[e],f[e+1],f[e+2],f[t],f[t+1],f[t+2],f[r],f[r+1],f[r+2])}function o(e,t,r){l.uvs.push(m[e],m[e+1],m[t],m[t+1],m[r],m[r+1])}function h(e,a,h,c,l,d,u,p,f,m,g,v){var y,b=t(e),w=t(a),x=t(h);void 0===c?s(b,w,x):(y=t(c),s(b,w,y),s(w,x,y)),void 0!==l&&(b=i(l),w=i(d),x=i(u),void 0===c?o(b,w,x):(y=i(p),o(b,w,y),o(w,x,y))),void 0!==f&&(b=r(f),w=r(m),x=r(g),void 0===c?n(b,w,x):(y=r(v),n(b,w,y),n(w,x,y)))}console.time("OBJLoader");var c,l,d,u=[];/^o /gm.test(e)===!1&&(l={vertices:[],normals:[],uvs:[]},d={name:""},c={name:"",geometry:l,material:d},u.push(c));for(var p=[],f=[],m=[],g=/v( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,v=/vn( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,y=/vt( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,b=/f( +-?\d+)( +-?\d+)( +-?\d+)( +-?\d+)?/,w=/f( +(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+))?/,x=/f( +(-?\d+)\/(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+)\/(-?\d+))?/,_=/f( +(-?\d+)\/\/(-?\d+))( +(-?\d+)\/\/(-?\d+))( +(-?\d+)\/\/(-?\d+))( +(-?\d+)\/\/(-?\d+))?/,A=e.split("\n"),k=0;k<A.length;k++){var T=A[k];T=T.trim();var M;0!==T.length&&"#"!==T.charAt(0)&&(null!==(M=g.exec(T))?p.push(parseFloat(M[1]),parseFloat(M[2]),parseFloat(M[3])):null!==(M=v.exec(T))?f.push(parseFloat(M[1]),parseFloat(M[2]),parseFloat(M[3])):null!==(M=y.exec(T))?m.push(parseFloat(M[1]),parseFloat(M[2])):null!==(M=b.exec(T))?h(M[1],M[2],M[3],M[4]):null!==(M=w.exec(T))?h(M[2],M[5],M[8],M[11],M[3],M[6],M[9],M[12]):null!==(M=x.exec(T))?h(M[2],M[6],M[10],M[14],M[3],M[7],M[11],M[15],M[4],M[8],M[12],M[16]):null!==(M=_.exec(T))?h(M[2],M[5],M[8],M[11],void 0,void 0,void 0,void 0,M[3],M[6],M[9],M[12]):/^o /.test(T)?(l={vertices:[],normals:[],uvs:[]},d={name:""},c={name:T.substring(2).trim(),geometry:l,material:d},u.push(c)):/^g /.test(T)||(/^usemtl /.test(T)?d.name=T.substring(7).trim():/^mtllib /.test(T)||/^s /.test(T)))}for(var C=new a.Object3D,k=0,L=u.length;L>k;k++){c=u[k],l=c.geometry;var N=new a.BufferGeometry;N.addAttribute("position",new a.BufferAttribute(new Float32Array(l.vertices),3)),l.normals.length>0&&N.addAttribute("normal",new a.BufferAttribute(new Float32Array(l.normals),3)),l.uvs.length>0&&N.addAttribute("uv",new a.BufferAttribute(new Float32Array(l.uvs),2)),d=new a.MeshLambertMaterial,d.name=c.material.name;var U=new a.Mesh(N,d);U.name=c.name,C.add(U)}return console.timeEnd("OBJLoader"),C}}},function(e,t,r){var a=r(1);a.OBJMTLLoader=function(e){this.manager=void 0!==e?e:a.DefaultLoadingManager},a.OBJMTLLoader.prototype={constructor:a.OBJMTLLoader,load:function(e,t,r,i,s){var n=this,o=new a.MTLLoader(this.manager);o.setBaseUrl(e.substr(0,e.lastIndexOf("/")+1)),o.setCrossOrigin(this.crossOrigin),o.load(t,function(t){var o=t;o.preload();var h=new a.XHRLoader(n.manager);h.setCrossOrigin(n.crossOrigin),h.load(e,function(e){var t=n.parse(e);t.traverse(function(e){if(e instanceof a.Mesh&&e.material.name){var t=o.create(e.material.name);t&&(e.material=t)}}),r(t)},i,s)},i,s)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){function r(e,t,r){return new a.Vector3(e,t,r)}function i(e,t){return new a.Vector2(e,t)}function s(e,t,r,i){return new a.Face3(e,t,r,i)}function n(e,t){g.length>0&&(p.vertices=g,p.mergeVertices(),p.computeFaceNormals(),p.computeBoundingSphere(),u.add(m),p=new a.Geometry,m=new a.Mesh(p,f)),void 0!==e&&(m.name=e),void 0!==t&&(f=new a.MeshLambertMaterial,f.name=t,m.material=f)}function o(e,t,r,a){void 0===a?p.faces.push(s(parseInt(e)-(l+1),parseInt(t)-(l+1),parseInt(r)-(l+1))):p.faces.push(s(parseInt(e)-(l+1),parseInt(t)-(l+1),parseInt(r)-(l+1),[v[parseInt(a[0])-1].clone(),v[parseInt(a[1])-1].clone(),v[parseInt(a[2])-1].clone()]))}function h(e,t,r){p.faceVertexUvs[0].push([y[parseInt(e)-1].clone(),y[parseInt(t)-1].clone(),y[parseInt(r)-1].clone()])}function c(e,t,r){void 0===e[3]?(o(e[0],e[1],e[2],r),void 0!==t&&t.length>0&&h(t[0],t[1],t[2])):(void 0!==r&&r.length>0?(o(e[0],e[1],e[3],[r[0],r[1],r[3]]),o(e[1],e[2],e[3],[r[1],r[2],r[3]])):(o(e[0],e[1],e[3]),o(e[1],e[2],e[3])),void 0!==t&&t.length>0&&(h(t[0],t[1],t[3]),h(t[1],t[2],t[3])))}for(var l=0,d=new a.Group,u=d,p=new a.Geometry,f=new a.MeshLambertMaterial,m=new a.Mesh(p,f),g=[],v=[],y=[],b=/v( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,w=/vn( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,x=/vt( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,_=/f( +\d+)( +\d+)( +\d+)( +\d+)?/,A=/f( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))?/,k=/f( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))?/,T=/f( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))?/,M=e.split("\n"),C=0;C<M.length;C++){var L=M[C];L=L.trim();var N;if(0!==L.length&&"#"!==L.charAt(0))if(null!==(N=b.exec(L)))g.push(r(parseFloat(N[1]),parseFloat(N[2]),parseFloat(N[3])));else if(null!==(N=w.exec(L)))v.push(r(parseFloat(N[1]),parseFloat(N[2]),parseFloat(N[3])));else if(null!==(N=x.exec(L)))y.push(i(parseFloat(N[1]),parseFloat(N[2])));else if(null!==(N=_.exec(L)))c([N[1],N[2],N[3],N[4]]);else if(null!==(N=A.exec(L)))c([N[2],N[5],N[8],N[11]],[N[3],N[6],N[9],N[12]]);else if(null!==(N=k.exec(L)))c([N[2],N[6],N[10],N[14]],[N[3],N[7],N[11],N[15]],[N[4],N[8],N[12],N[16]]);else if(null!==(N=T.exec(L)))c([N[2],N[5],N[8],N[11]],[],[N[3],N[6],N[9],N[12]]);else if(/^o /.test(L))n(),l+=g.length,g=[],u=new a.Object3D,u.name=L.substring(2).trim(),d.add(u);else if(/^g /.test(L))n(L.substring(2).trim(),void 0);else if(/^usemtl /.test(L))n(void 0,L.substring(7).trim());else if(/^mtllib /.test(L)){if(t){var U=L.substring(7);U=U.trim(),t(U)}}else/^s /.test(L)||console.log("THREE.OBJMTLLoader: Unhandled line "+L)}return n(void 0,void 0),d}},a.EventDispatcher.prototype.apply(a.OBJMTLLoader.prototype);
},function(e,t,r){var a=r(1);a.PDBLoader=function(e){this.manager=void 0!==e?e:a.DefaultLoadingManager},a.PDBLoader.prototype={constructor:a.PDBLoader,load:function(e,t,r,i){var s=this,n=new a.XHRLoader(s.manager);n.setCrossOrigin(this.crossOrigin),n.load(e,function(e){var r=s.parsePDB(e);s.createModel(r,t)},r,i)},setCrossOrigin:function(e){this.crossOrigin=e},parsePDB:function(e){function t(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function r(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}function a(e,t){return"s"+Math.min(e,t)+"e"+Math.max(e,t)}function i(e,t){var r=parseInt(f[m].substr(e,t));if(r){var i=a(v,r);void 0==p[i]&&(d.push([v-1,r-1,1]),p[i]=d.length-1)}}for(var s,n,o,h,c={h:[255,255,255],he:[217,255,255],li:[204,128,255],be:[194,255,0],b:[255,181,181],c:[144,144,144],n:[48,80,248],o:[255,13,13],f:[144,224,80],ne:[179,227,245],na:[171,92,242],mg:[138,255,0],al:[191,166,166],si:[240,200,160],p:[255,128,0],s:[255,255,48],cl:[31,240,31],ar:[128,209,227],k:[143,64,212],ca:[61,255,0],sc:[230,230,230],ti:[191,194,199],v:[166,166,171],cr:[138,153,199],mn:[156,122,199],fe:[224,102,51],co:[240,144,160],ni:[80,208,80],cu:[200,128,51],zn:[125,128,176],ga:[194,143,143],ge:[102,143,143],as:[189,128,227],se:[255,161,0],br:[166,41,41],kr:[92,184,209],rb:[112,46,176],sr:[0,255,0],y:[148,255,255],zr:[148,224,224],nb:[115,194,201],mo:[84,181,181],tc:[59,158,158],ru:[36,143,143],rh:[10,125,140],pd:[0,105,133],ag:[192,192,192],cd:[255,217,143],"in":[166,117,115],sn:[102,128,128],sb:[158,99,181],te:[212,122,0],i:[148,0,148],xe:[66,158,176],cs:[87,23,143],ba:[0,201,0],la:[112,212,255],ce:[255,255,199],pr:[217,255,199],nd:[199,255,199],pm:[163,255,199],sm:[143,255,199],eu:[97,255,199],gd:[69,255,199],tb:[48,255,199],dy:[31,255,199],ho:[0,255,156],er:[0,230,117],tm:[0,212,82],yb:[0,191,56],lu:[0,171,36],hf:[77,194,255],ta:[77,166,255],w:[33,148,214],re:[38,125,171],os:[38,102,150],ir:[23,84,135],pt:[208,208,224],au:[255,209,35],hg:[184,184,208],tl:[166,84,77],pb:[87,89,97],bi:[158,79,181],po:[171,92,0],at:[117,79,69],rn:[66,130,150],fr:[66,0,102],ra:[0,125,0],ac:[112,171,250],th:[0,186,255],pa:[0,161,255],u:[0,143,255],np:[0,128,255],pu:[0,107,255],am:[84,92,242],cm:[120,92,227],bk:[138,79,227],cf:[161,54,212],es:[179,31,212],fm:[179,31,186],md:[179,13,166],no:[189,13,135],lr:[199,0,102],rf:[204,0,89],db:[209,0,79],sg:[217,0,69],bh:[224,0,56],hs:[230,0,46],mt:[235,0,38],ds:[235,0,38],rg:[235,0,38],cn:[235,0,38],uut:[235,0,38],uuq:[235,0,38],uup:[235,0,38],uuh:[235,0,38],uus:[235,0,38],uuo:[235,0,38]},l=[],d=[],u={},p={},f=e.split("\n"),m=0,g=f.length;g>m;++m)if("ATOM"==f[m].substr(0,4)||"HETATM"==f[m].substr(0,6))s=parseFloat(f[m].substr(30,7)),n=parseFloat(f[m].substr(38,7)),o=parseFloat(f[m].substr(46,7)),h=t(f[m].substr(76,2)).toLowerCase(),""==h&&(h=t(f[m].substr(12,2)).toLowerCase()),l.push([s,n,o,c[h],r(h)]),void 0==u[h]?u[h]=1:u[h]+=1;else if("CONECT"==f[m].substr(0,6)){var v=parseInt(f[m].substr(6,5));i(11,5),i(16,5),i(21,5),i(26,5)}return{ok:!0,atoms:l,bonds:d,histogram:u}},createModel:function(e,t){var r=new a.Geometry,i=new a.Geometry;r.elements=[];for(var s=e.atoms,n=e.bonds,o=0;o<s.length;o++){var h=s[o],c=h[0],l=h[1],d=h[2],u=new a.Vector3(c,l,d);r.vertices.push(u);var p=h[3][0]/255,f=h[3][1]/255,m=h[3][2]/255,g=new a.Color;g.setRGB(p,f,m),r.colors.push(g),r.elements.push(h[4])}for(var o=0;o<n.length;o++){var v=n[o],y=v[0],b=v[1],w=r.vertices[y],x=r.vertices[b];i.vertices.push(w.clone()),i.vertices.push(x.clone())}t(r,i,e)}}},function(e,t,r){var a=r(1);a.PLYLoader=function(e){this.manager=void 0!==e?e:a.DefaultLoadingManager,this.propertyNameMapping={}},a.PLYLoader.prototype={constructor:a.PLYLoader,load:function(e,t,r,i){var s=this,n=new a.XHRLoader(this.manager);n.setCrossOrigin(this.crossOrigin),n.setResponseType("arraybuffer"),n.load(e,function(e){t(s.parse(e))},r,i)},setCrossOrigin:function(e){this.crossOrigin=e},setPropertyNameMapping:function(e){this.propertyNameMapping=e},bin2str:function(e){for(var t=new Uint8Array(e),r="",a=0;a<e.byteLength;a++)r+=String.fromCharCode(t[a]);return r},isASCII:function(e){var t=this.parseHeader(this.bin2str(e));return"ascii"===t.format},parse:function(e){return e instanceof ArrayBuffer?this.isASCII(e)?this.parseASCII(this.bin2str(e)):this.parseBinary(e):this.parseASCII(e)},parseHeader:function(e){function t(e,t){var r={type:e[0]};return"list"===r.type?(r.name=e[3],r.countType=e[1],r.itemType=e[2]):r.name=e[1],r.name in t&&(r.name=t[r.name]),r}var r=/ply([\s\S]*)end_header\s/,a="",i=0,s=r.exec(e);null!==s&&(a=s[1],i=s[0].length);for(var n,o,h={comments:[],elements:[],headerLength:i},c=a.split("\n"),l=void 0,d=0;d<c.length;d++){var u=c[d];if(u=u.trim(),""!==u)switch(o=u.split(/\s+/),n=o.shift(),u=o.join(" "),n){case"format":h.format=o[0],h.version=o[1];break;case"comment":h.comments.push(u);break;case"element":void 0!==l&&h.elements.push(l),l=Object(),l.name=o[0],l.count=parseInt(o[1]),l.properties=[];break;case"property":l.properties.push(t(o,this.propertyNameMapping));break;default:console.log("unhandled",n,o)}}return void 0!==l&&h.elements.push(l),h},parseASCIINumber:function(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}},parseASCIIElement:function(e,t){for(var r=t.split(/\s+/),a=Object(),i=0;i<e.length;i++)if("list"===e[i].type){for(var s=[],n=this.parseASCIINumber(r.shift(),e[i].countType),o=0;n>o;o++)s.push(this.parseASCIINumber(r.shift(),e[i].itemType));a[e[i].name]=s}else a[e[i].name]=this.parseASCIINumber(r.shift(),e[i].type);return a},parseASCII:function(e){var t,r=new a.Geometry,i=this.parseHeader(e),s=/end_header\s([\s\S]*)$/,n="";null!==(t=s.exec(e))&&(n=t[1]);var o=n.split("\n"),h=0,c=0;r.useColor=!1;for(var l=0;l<o.length;l++){var d=o[l];if(d=d.trim(),""!==d){c>=i.elements[h].count&&(h++,c=0);var u=this.parseASCIIElement(i.elements[h].properties,d);this.handleElement(r,i.elements[h].name,u),c++}}return this.postProcess(r)},postProcess:function(e){if(e.useColor){for(var t=0;t<e.faces.length;t++)e.faces[t].vertexColors=[e.colors[e.faces[t].a],e.colors[e.faces[t].b],e.colors[e.faces[t].c]];e.elementsNeedUpdate=!0}return e.computeBoundingSphere(),e},handleElement:function(e,t,r){if("vertex"===t){if(e.vertices.push(new a.Vector3(r.x,r.y,r.z)),"red"in r&&"green"in r&&"blue"in r){e.useColor=!0;var i=new a.Color;i.setRGB(r.red/255,r.green/255,r.blue/255),e.colors.push(i)}}else if("face"===t){var s=r.vertex_indices;3===s.length?e.faces.push(new a.Face3(s[0],s[1],s[2])):4===s.length&&e.faces.push(new a.Face3(s[0],s[1],s[3]),new a.Face3(s[1],s[2],s[3]))}},binaryRead:function(e,t,r,a){switch(r){case"int8":case"char":return[e.getInt8(t),1];case"uint8":case"uchar":return[e.getUint8(t),1];case"int16":case"short":return[e.getInt16(t,a),2];case"uint16":case"ushort":return[e.getUint16(t,a),2];case"int32":case"int":return[e.getInt32(t,a),4];case"uint32":case"uint":return[e.getUint32(t,a),4];case"float32":case"float":return[e.getFloat32(t,a),4];case"float64":case"double":return[e.getFloat64(t,a),8]}},binaryReadElement:function(e,t,r,a){for(var i,s=Object(),n=0,o=0;o<r.length;o++)if("list"===r[o].type){var h=[];i=this.binaryRead(e,t+n,r[o].countType,a);var c=i[0];n+=i[1];for(var l=0;c>l;l++)i=this.binaryRead(e,t+n,r[o].itemType,a),h.push(i[0]),n+=i[1];s[r[o].name]=h}else i=this.binaryRead(e,t+n,r[o].type,a),s[r[o].name]=i[0],n+=i[1];return[s,n]},parseBinary:function(e){for(var t,r=new a.Geometry,i=this.parseHeader(this.bin2str(e)),s="binary_little_endian"===i.format,n=new DataView(e,i.headerLength),o=0,h=0;h<i.elements.length;h++)for(var c=0;c<i.elements[h].count;c++){t=this.binaryReadElement(n,o,i.elements[h].properties,s),o+=t[1];var l=t[0];this.handleElement(r,i.elements[h].name,l)}return this.postProcess(r)}}},function(e,t,r){var a=r(1);a.PVRLoader=function(e){this.manager=void 0!==e?e:a.DefaultLoadingManager,this._parser=a.PVRLoader.parse},a.PVRLoader.prototype=Object.create(a.CompressedTextureLoader.prototype),a.PVRLoader.prototype.constructor=a.PVRLoader,a.PVRLoader.parse=function(e,t){var r=13,i=new Uint32Array(e,0,r),s={buffer:e,header:i,loadMipmaps:t};if(55727696===i[0])return a.PVRLoader._parseV3(s);if(559044176===i[11])return a.PVRLoader._parseV2(s);throw new Error("[THREE.PVRLoader] Unknown PVR format")},a.PVRLoader._parseV3=function(e){var t,r,i=e.header,s=i[12],n=i[2],o=i[6],h=i[7],c=(i[9],i[10]),l=i[11];switch(n){case 0:t=2,r=a.RGB_PVRTC_2BPPV1_Format;break;case 1:t=2,r=a.RGBA_PVRTC_2BPPV1_Format;break;case 2:t=4,r=a.RGB_PVRTC_4BPPV1_Format;break;case 3:t=4,r=a.RGBA_PVRTC_4BPPV1_Format;break;default:throw new Error("pvrtc - unsupported PVR format "+n)}return e.dataPtr=52+s,e.bpp=t,e.format=r,e.width=h,e.height=o,e.numSurfaces=c,e.numMipmaps=l,e.isCubemap=6===c,a.PVRLoader._extract(e)},a.PVRLoader._parseV2=function(e){var t,r,i=e.header,s=i[0],n=i[1],o=i[2],h=i[3],c=i[4],t=(i[5],i[6]),l=(i[7],i[8],i[9],i[10]),d=(i[11],i[12]),u=255,p=24,f=25,m=c&u,g=l>0;if(m===f)r=g?a.RGBA_PVRTC_4BPPV1_Format:a.RGB_PVRTC_4BPPV1_Format,t=4;else{if(m!==p)throw new Error("pvrtc - unknown format "+m);r=g?a.RGBA_PVRTC_2BPPV1_Format:a.RGB_PVRTC_2BPPV1_Format,t=2}return e.dataPtr=s,e.bpp=t,e.format=r,e.width=o,e.height=n,e.numSurfaces=d,e.numMipmaps=h+1,e.isCubemap=6===d,a.PVRLoader._extract(e)},a.PVRLoader._extract=function(e){var t={mipmaps:[],width:e.width,height:e.height,format:e.format,mipmapCount:e.numMipmaps,isCubemap:e.isCubemap},r=e.buffer,a=e.dataPtr,i=e.bpp,s=e.numSurfaces,n=0,o=0,h=0,c=0,l=0,d=0;2===i?(h=8,c=4):(h=4,c=4),o=h*c*i/8,t.mipmaps.length=e.numMipmaps*s;for(var u=0;u<e.numMipmaps;){var p=e.width>>u,f=e.height>>u;l=p/h,d=f/c,2>l&&(l=2),2>d&&(d=2),n=l*d*o;for(var m=0;s>m;m++){var g=new Uint8Array(r,a,n),v={data:g,width:p,height:f};t.mipmaps[m*e.numMipmaps+u]=v,a+=n}u++}return t}},function(e,t,r){var a=r(1);a.HDRLoader=a.RGBELoader=function(e){this.manager=void 0!==e?e:a.DefaultLoadingManager},a.RGBELoader.prototype=Object.create(a.BinaryTextureLoader.prototype),a.RGBELoader.prototype._parser=function(e){var t=-1,r=1,i=2,s=3,n=4,o=function(e,a){switch(e){case r:console.error("THREE.RGBELoader Read Error: "+(a||""));break;case i:console.error("THREE.RGBELoader Write Error: "+(a||""));break;case s:console.error("THREE.RGBELoader Bad File Format: "+(a||""));break;default:case n:console.error("THREE.RGBELoader: Error: "+(a||""))}return t},h=1,c=2,l=4,d="\n",u=function(e,t,r){t=t?t:1024;for(var a=e.pos,i=-1,s=0,n="",o=128,h=String.fromCharCode.apply(null,new Uint16Array(e.subarray(a,a+o)));0>(i=h.indexOf(d))&&t>s&&a<e.byteLength;)n+=h,s+=h.length,a+=o,h+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(a,a+o)));return i>-1?(!1!==r&&(e.pos+=s+i+1),n+h.slice(0,i)):!1},p=function(e){var t,a,i=/^#\?(\S+)$/,n=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,d=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,p=/^\s*FORMAT=(\S+)\s*$/,f=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,m={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(e.pos>=e.byteLength||!(t=u(e)))return o(r,"no header found");if(!(a=t.match(i)))return o(s,"bad initial token");for(m.valid|=h,m.programtype=a[1],m.string+=t+"\n";;){if(t=u(e),!1===t)break;if(m.string+=t+"\n","#"!==t.charAt(0)){if((a=t.match(n))&&(m.gamma=parseFloat(a[1],10)),(a=t.match(d))&&(m.exposure=parseFloat(a[1],10)),(a=t.match(p))&&(m.valid|=c,m.format=a[1]),(a=t.match(f))&&(m.valid|=l,m.height=parseInt(a[1],10),m.width=parseInt(a[2],10)),m.valid&c&&m.valid&l)break}else m.comments+=t+"\n"}return m.valid&c?m.valid&l?m:o(s,"missing image size specifier"):o(s,"missing format specifier")},f=function(e,t,a){var i,h,c,l,d,u,p,f,m,g,v,y,b,w=t,x=a;if(8>w||w>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(w!==(e[2]<<8|e[3]))return o(s,"wrong scanline width");if(i=new Uint8Array(4*t*a),!i||!i.length)return o(n,"unable to allocate buffer space");for(h=0,c=0,f=4*w,b=new Uint8Array(4),u=new Uint8Array(f);x>0&&c<e.byteLength;){if(c+4>e.byteLength)return o(r);if(b[0]=e[c++],b[1]=e[c++],b[2]=e[c++],b[3]=e[c++],2!=b[0]||2!=b[1]||(b[2]<<8|b[3])!=w)return o(s,"bad rgbe scanline format");for(p=0;f>p&&c<e.byteLength;){if(l=e[c++],y=l>128,y&&(l-=128),0===l||p+l>f)return o(s,"bad scanline data");if(y)for(d=e[c++],m=0;l>m;m++)u[p++]=d;else u.set(e.subarray(c,c+l),p),p+=l,c+=l}for(g=w,m=0;g>m;m++)v=0,i[h]=u[m+v],v+=w,i[h+1]=u[m+v],v+=w,i[h+2]=u[m+v],v+=w,i[h+3]=u[m+v],h+=4;x--}return i},m=new Uint8Array(e);m.byteLength;m.pos=0;var g=p(m);if(t!==g){var v=g.width,y=g.height,b=f(m.subarray(m.pos),v,y);if(t!==b)return{width:v,height:y,data:b,header:g.string,gamma:g.gamma,exposure:g.exposure,format:a.RGBEFormat,type:a.UnsignedByteType}}return null}},function(e,t,r){var a=r(1);a.STLLoader=function(e){this.manager=void 0!==e?e:a.DefaultLoadingManager},a.STLLoader.prototype={constructor:a.STLLoader,load:function(e,t,r,i){var s=this,n=new a.XHRLoader(s.manager);n.setCrossOrigin(this.crossOrigin),n.setResponseType("arraybuffer"),n.load(e,function(e){t(s.parse(e))},r,i)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=function(){var e,t,a,i;if(i=new DataView(r),t=50,a=i.getUint32(80,!0),e=84+a*t,e===i.byteLength)return!0;for(var s=i.byteLength,n=0;s>n;n++)if(i.getUint8(n,!1)>127)return!0;return!1},r=this.ensureBinary(e);return t()?this.parseBinary(r):this.parseASCII(this.ensureString(e))},parseBinary:function(e){for(var t,r,i,s,n,o,h,c,l=new DataView(e),d=l.getUint32(80,!0),u=!1,p=0;70>p;p++)1129270351==l.getUint32(p,!1)&&82==l.getUint8(p+4)&&61==l.getUint8(p+5)&&(u=!0,s=new Float32Array(3*d*3),n=l.getUint8(p+6)/255,o=l.getUint8(p+7)/255,h=l.getUint8(p+8)/255,c=l.getUint8(p+9)/255);for(var f=84,m=50,g=0,v=new a.BufferGeometry,y=new Float32Array(3*d*3),b=new Float32Array(3*d*3),w=0;d>w;w++){var x=f+w*m,_=l.getFloat32(x,!0),A=l.getFloat32(x+4,!0),k=l.getFloat32(x+8,!0);if(u){var T=l.getUint16(x+48,!0);0===(32768&T)?(t=(31&T)/31,r=(T>>5&31)/31,i=(T>>10&31)/31):(t=n,r=o,i=h)}for(var M=1;3>=M;M++){var C=x+12*M;y[g]=l.getFloat32(C,!0),y[g+1]=l.getFloat32(C+4,!0),y[g+2]=l.getFloat32(C+8,!0),b[g]=_,b[g+1]=A,b[g+2]=k,u&&(s[g]=t,s[g+1]=r,s[g+2]=i),g+=3}}return v.addAttribute("position",new a.BufferAttribute(y,3)),v.addAttribute("normal",new a.BufferAttribute(b,3)),u&&(v.addAttribute("color",new a.BufferAttribute(s,3)),v.hasColors=!0,v.alpha=c),v},parseASCII:function(e){var t,r,i,s,n,o,h,c;for(t=new a.Geometry,s=/facet([\s\S]*?)endfacet/g;null!==(h=s.exec(e));){for(c=h[0],n=/normal[\s]+([\-+]?[0-9]+\.?[0-9]*([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+/g;null!==(h=n.exec(c));)i=new a.Vector3(parseFloat(h[1]),parseFloat(h[3]),parseFloat(h[5]));for(o=/vertex[\s]+([\-+]?[0-9]+\.?[0-9]*([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+/g;null!==(h=o.exec(c));)t.vertices.push(new a.Vector3(parseFloat(h[1]),parseFloat(h[3]),parseFloat(h[5])));r=t.vertices.length,t.faces.push(new a.Face3(r-3,r-2,r-1,i))}return t.computeBoundingBox(),t.computeBoundingSphere(),t},ensureString:function(e){if("string"!=typeof e){for(var t=new Uint8Array(e),r="",a=0;a<e.byteLength;a++)r+=String.fromCharCode(t[a]);return r}return e},ensureBinary:function(e){if("string"==typeof e){for(var t=new Uint8Array(e.length),r=0;r<e.length;r++)t[r]=255&e.charCodeAt(r);return t.buffer||t}return e}},"undefined"==typeof DataView&&(DataView=function(e,t,r){this.buffer=e,this.byteOffset=t||0,this.byteLength=r||e.byteLength||e.length,this._isString="string"==typeof e},DataView.prototype={_getCharCodes:function(e,t,r){t=t||0,r=r||e.length;for(var a=t+r,i=[],s=t;a>s;s++)i.push(255&e.charCodeAt(s));return i},_getBytes:function(e,t,r){var a;if(void 0===r&&(r=this._littleEndian),t=void 0===t?this.byteOffset:this.byteOffset+t,void 0===e&&(e=this.byteLength-t),"number"!=typeof t)throw new TypeError("DataView byteOffset is not a number");if(0>e||t+e>this.byteLength)throw new Error("DataView length or (byteOffset+length) value is out of bounds");return a=this.isString?this._getCharCodes(this.buffer,t,t+e):this.buffer.slice(t,t+e),!r&&e>1&&(Array.isArray(a)===!1&&(a=Array.prototype.slice.call(a)),a.reverse()),a},getFloat64:function(e,t){var r=this._getBytes(8,e,t),a=1-2*(r[7]>>7),i=((r[7]<<1&255)<<3|r[6]>>4)-1023,s=(15&r[6])*Math.pow(2,48)+r[5]*Math.pow(2,40)+r[4]*Math.pow(2,32)+r[3]*Math.pow(2,24)+r[2]*Math.pow(2,16)+r[1]*Math.pow(2,8)+r[0];return 1024===i?0!==s?NaN:a*(1/0):-1023===i?a*s*Math.pow(2,-1074):a*(1+s*Math.pow(2,-52))*Math.pow(2,i)},getFloat32:function(e,t){var r=this._getBytes(4,e,t),a=1-2*(r[3]>>7),i=(r[3]<<1&255|r[2]>>7)-127,s=(127&r[2])<<16|r[1]<<8|r[0];return 128===i?0!==s?NaN:a*(1/0):-127===i?a*s*Math.pow(2,-149):a*(1+s*Math.pow(2,-23))*Math.pow(2,i)},getInt32:function(e,t){var r=this._getBytes(4,e,t);return r[3]<<24|r[2]<<16|r[1]<<8|r[0]},getUint32:function(e,t){return this.getInt32(e,t)>>>0},getInt16:function(e,t){return this.getUint16(e,t)<<16>>16},getUint16:function(e,t){var r=this._getBytes(2,e,t);return r[1]<<8|r[0]},getInt8:function(e){return this.getUint8(e)<<24>>24},getUint8:function(e){return this._getBytes(1,e)[0]}})},function(e,t,r){var a=r(1);a.SVGLoader=function(e){this.manager=void 0!==e?e:a.DefaultLoadingManager},a.SVGLoader.prototype={constructor:a.SVGLoader,load:function(e,t,r,i){var s=this,n=new DOMParser,o=new a.XHRLoader(s.manager);o.setCrossOrigin(this.crossOrigin),o.load(e,function(e){var r=n.parseFromString(e,"image/svg+xml");t(r.firstChild)},r,i)},setCrossOrigin:function(e){this.crossOrigin=e}}},function(e,t,r){var a=r(1);a.TGALoader=function(e){this.manager=void 0!==e?e:a.DefaultLoadingManager},a.TGALoader.prototype=Object.create(a.BinaryTextureLoader.prototype),a.TGALoader.prototype._parser=function(e){function t(e){switch(e.image_type){case d:case f:(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)&&console.error("THREE.TGALoader.parse.tgaCheckHeader: Invalid type colormap data for indexed type");break;case u:case p:case m:case g:e.colormap_type&&console.error("THREE.TGALoader.parse.tgaCheckHeader: Invalid type colormap data for colormap type");break;case l:console.error("THREE.TGALoader.parse.tgaCheckHeader: No data");default:console.error('THREE.TGALoader.parse.tgaCheckHeader: Invalid type " '+e.image_type+'"')}(e.width<=0||e.height<=0)&&console.error("THREE.TGALoader.parse.tgaCheckHeader: Invalid image size"),8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size&&console.error('THREE.TGALoader.parse.tgaCheckHeader: Invalid pixel size "'+e.pixel_size+'"')}function r(e,t,r,a,i){var s,n,o,h;if(n=r.pixel_size>>3,o=r.width*r.height*n,t&&(h=i.subarray(a,a+=r.colormap_length*(r.colormap_size>>3))),e){s=new Uint8Array(o);for(var c,l,d,u=0,p=new Uint8Array(n);o>u;)if(c=i[a++],l=(127&c)+1,128&c){for(d=0;n>d;++d)p[d]=i[a++];for(d=0;l>d;++d)s.set(p,u+d*n);u+=n*l}else{for(l*=n,d=0;l>d;++d)s[u+d]=i[a++];u+=l}}else s=i.subarray(a,a+=t?r.width*r.height:o);return{pixel_data:s,palettes:h}}function a(e,t,r,a,i,s,n,o,h){var c,l,d,u=h,p=0,f=T.width;for(d=t;d!==a;d+=r)for(l=i;l!==n;l+=s,p++)c=o[p],e[4*(l+f*d)+3]=255,e[4*(l+f*d)+2]=u[3*c+0],e[4*(l+f*d)+1]=u[3*c+1],e[4*(l+f*d)+0]=u[3*c+2];return e}function i(e,t,r,a,i,s,n,o){var h,c,l,d=0,u=T.width;for(l=t;l!==a;l+=r)for(c=i;c!==n;c+=s,d+=2)h=o[d+0]+(o[d+1]<<8),e[4*(c+u*l)+0]=(31744&h)>>7,e[4*(c+u*l)+1]=(992&h)>>2,e[4*(c+u*l)+2]=(31&h)>>3,e[4*(c+u*l)+3]=32768&h?0:255;return e}function s(e,t,r,a,i,s,n,o){var h,c,l=0,d=T.width;for(c=t;c!==a;c+=r)for(h=i;h!==n;h+=s,l+=3)e[4*(h+d*c)+3]=255,e[4*(h+d*c)+2]=o[l+0],e[4*(h+d*c)+1]=o[l+1],e[4*(h+d*c)+0]=o[l+2];return e}function n(e,t,r,a,i,s,n,o){var h,c,l=0,d=T.width;for(c=t;c!==a;c+=r)for(h=i;h!==n;h+=s,l+=4)e[4*(h+d*c)+2]=o[l+0],e[4*(h+d*c)+1]=o[l+1],e[4*(h+d*c)+0]=o[l+2],e[4*(h+d*c)+3]=o[l+3];return e}function o(e,t,r,a,i,s,n,o){var h,c,l,d=0,u=T.width;for(l=t;l!==a;l+=r)for(c=i;c!==n;c+=s,d++)h=o[d],e[4*(c+u*l)+0]=h,e[4*(c+u*l)+1]=h,e[4*(c+u*l)+2]=h,e[4*(c+u*l)+3]=255;return e}function h(e,t,r,a,i,s,n,o){var h,c,l=0,d=T.width;for(c=t;c!==a;c+=r)for(h=i;h!==n;h+=s,l+=2)e[4*(h+d*c)+0]=o[l+0],e[4*(h+d*c)+1]=o[l+0],e[4*(h+d*c)+2]=o[l+0],e[4*(h+d*c)+3]=o[l+1];return e}function c(e,t,r,c){var l,d,u,p,f,m,g=new Uint8Array(e*t*4);switch((T.flags&v)>>y){default:case x:l=0,u=1,f=e,d=0,p=1,m=t;break;case b:l=0,u=1,f=e,d=t-1,p=-1,m=-1;break;case _:l=e-1,u=-1,f=-1,d=0,p=1,m=t;break;case w:l=e-1,u=-1,f=-1,d=t-1,p=-1,m=-1}if(L)switch(T.pixel_size){case 8:o(g,d,p,m,l,u,f,r);break;case 16:h(g,d,p,m,l,u,f,r);break;default:console.error("THREE.TGALoader.parse.getTgaRGBA: not support this format")}else switch(T.pixel_size){case 8:a(g,d,p,m,l,u,f,r,c);break;case 16:i(g,d,p,m,l,u,f,r);break;case 24:s(g,d,p,m,l,u,f,r);break;case 32:n(g,d,p,m,l,u,f,r);break;default:console.error("THREE.TGALoader.parse.getTgaRGBA: not support this format")}return g}var l=0,d=1,u=2,p=3,f=9,m=10,g=11,v=48,y=4,b=0,w=1,x=2,_=3;e.length<19&&console.error("THREE.TGALoader.parse: Not enough data to contain header.");var A=new Uint8Array(e),k=0,T={id_length:A[k++],colormap_type:A[k++],image_type:A[k++],colormap_index:A[k++]|A[k++]<<8,colormap_length:A[k++]|A[k++]<<8,colormap_size:A[k++],origin:[A[k++]|A[k++]<<8,A[k++]|A[k++]<<8],width:A[k++]|A[k++]<<8,height:A[k++]|A[k++]<<8,pixel_size:A[k++],flags:A[k++]};t(T),T.id_length+k>e.length&&console.error("THREE.TGALoader.parse: No data"),k+=T.id_length;var M=!1,C=!1,L=!1;switch(T.image_type){case f:M=!0,C=!0;break;case d:C=!0;break;case m:M=!0;break;case u:break;case g:M=!0,L=!0;break;case p:L=!0}var N=r(M,C,T,k,A),U=c(T.width,T.height,N.pixel_data,N.palettes);return{width:T.width,height:T.height,data:U}}},function(e,t,r){function a(e,t,r){var a=new s.XHRLoader;a.load(e,t,r)}function i(e,t){a(e,function(e){t(JSON.parse(e))},function(){})}var s=r(1);s.UTF8Loader=function(){},s.UTF8Loader.prototype.load=function(e,t,r){this.downloadModelJson(e,t,r)},s.UTF8Loader.BufferGeometryCreator=function(){},s.UTF8Loader.BufferGeometryCreator.prototype.create=function(e,t){var r,a,i,n,o,h,c,l,d=t.length/3,u=new s.BufferGeometry,p=new Float32Array(3*d*3),f=new Float32Array(3*d*3),m=new Float32Array(3*d*2),g=e.length,v=8;for(a=0,i=0,r=i;g>r;r+=v)n=e[r],o=e[r+1],h=e[r+2],p[a++]=n,p[a++]=o,p[a++]=h;for(a=0,i=3,r=i;g>r;r+=v)c=e[r],l=e[r+1],m[a++]=c,m[a++]=l;for(a=0,i=5,r=i;g>r;r+=v)n=e[r],o=e[r+1],h=e[r+2],f[a++]=n,f[a++]=o,f[a++]=h;return u.setIndex(new s.BufferAttribute(t,1)),u.addAttribute("position",new s.BufferAttribute(p,3)),u.addAttribute("normal",new s.BufferAttribute(f,3)),u.addAttribute("uv",new s.BufferAttribute(m,2)),u.computeBoundingSphere(),u};var n={decodeOffsets:[-4095,-4095,-4095,0,0,-511,-511,-511],decodeScales:[1/8191,1/8191,1/8191,1/1023,1/1023,1/1023,1/1023,1/1023]};s.UTF8Loader.prototype.decompressAttribsInner_=function(e,t,r,a,i,s,n,o){for(var h=0,c=t;r>c;c++){var l=e.charCodeAt(c);h+=l>>1^-(1&l),a[i]=o*(h+n),i+=s}},s.UTF8Loader.prototype.decompressIndices_=function(e,t,r,a,i){for(var s=0,n=0;r>n;n++){var o=e.charCodeAt(t++);a[i++]=s-o,0===o&&s++}},s.UTF8Loader.prototype.decompressAABBs_=function(e,t,r,a,i){for(var s=6*r,n=t+s,o=0,h=new Float32Array(s),c=t;n>c;c+=6){var l=e.charCodeAt(c+0)+a[0],d=e.charCodeAt(c+1)+a[1],u=e.charCodeAt(c+2)+a[2],p=e.charCodeAt(c+3)+1>>1,f=e.charCodeAt(c+4)+1>>1,m=e.charCodeAt(c+5)+1>>1;h[o++]=i[0]*(l+p),h[o++]=i[1]*(d+f),h[o++]=i[2]*(u+m),h[o++]=i[0]*p,h[o++]=i[1]*f,h[o++]=i[2]*m}return h},s.UTF8Loader.prototype.decompressMesh=function(e,t,r,a,i,s){for(var n=r.decodeScales.length,o=r.decodeOffsets,h=r.decodeScales,c=t.attribRange[0],l=t.attribRange[1],d=c,u=new Float32Array(n*l),p=0;n>p;p++){var f=d+l,m=h[p];m&&this.decompressAttribsInner_(e,d,f,u,p,n,o[p],m),d=f}var g=(t.indexRange[0],3*t.indexRange[1]),v=new Uint16Array(g);this.decompressIndices_(e,d,g,v,0);var y=void 0,b=t.bboxes;b&&(y=this.decompressAABBs_(e,b,t.names.length,o,h)),s(a,i,u,v,y,t)},s.UTF8Loader.prototype.copyAttrib=function(e,t,r,a){for(var i=0;e>i;i++)r[i]=t[e*a+i]},s.UTF8Loader.prototype.decodeAttrib2=function(e,t,r,a,i,s,n,o,h,c){for(var l=0;5>l;l++){var d=e.charCodeAt(i+s*l+c),u=d>>1^-(1&d);h[l]+=u,o[t*c+l]=h[l],n[t*c+l]=a[l]*(h[l]+r[l])}},s.UTF8Loader.prototype.accumulateNormal=function(e,t,r,a,i){var s=a[8*e],n=a[8*e+1],o=a[8*e+2],h=a[8*t],c=a[8*t+1],l=a[8*t+2],d=a[8*r],u=a[8*r+1],p=a[8*r+2];h-=s,c-=n,l-=o,d-=s,u-=n,p-=o,s=c*p-l*u,n=l*d-h*p,o=h*u-c*d,i[3*e]+=s,i[3*e+1]+=n,i[3*e+2]+=o,i[3*t]+=s,i[3*t+1]+=n,i[3*t+2]+=o,i[3*r]+=s,i[3*r+1]+=n,i[3*r+2]+=o},s.UTF8Loader.prototype.decompressMesh2=function(e,t,r,a,i,s){for(var n=96,o=r.decodeScales.length,h=r.decodeOffsets,c=r.decodeScales,l=t.attribRange[0],d=t.attribRange[1],u=t.codeRange[0],p=(t.codeRange[1],3*t.codeRange[2]),f=new Uint16Array(p),m=new Int32Array(3*d),g=new Uint16Array(o),v=new Uint16Array(o*d),y=new Float32Array(o*d),b=0,w=0,x=0;p>x;x+=3){var _=e.charCodeAt(u++),A=Math.min(x,n);if(A>_){var k,T,M,C=_%3,L=x-(_-C);switch(C){case 0:k=f[L+2],T=f[L+1],M=f[L+0];break;case 1:k=f[L+0],T=f[L+2],M=f[L+1];break;case 2:k=f[L+1],T=f[L+0],M=f[L+2]}f[w++]=k,f[w++]=T,_=e.charCodeAt(u++);var N=b-_;if(f[w++]=N,0===_){for(var U=0;5>U;U++){var E=e.charCodeAt(l+d*U+b),F=(E>>1^-(1&E))+v[o*k+U]+v[o*T+U]-v[o*M+U];g[U]=F,v[o*b+U]=F,y[o*b+U]=c[U]*(F+h[U])}b++}else this.copyAttrib(o,v,g,N);this.accumulateNormal(k,T,N,v,m)}else{var B=b-(_-A);f[w++]=B,_===A?this.decodeAttrib2(e,o,h,c,l,d,y,v,g,b++):this.copyAttrib(o,v,g,B),_=e.charCodeAt(u++);var O=b-_;f[w++]=O,0===_?this.decodeAttrib2(e,o,h,c,l,d,y,v,g,b++):this.copyAttrib(o,v,g,O),_=e.charCodeAt(u++);var R=b-_;if(f[w++]=R,0===_){for(var U=0;5>U;U++)g[U]=(v[o*B+U]+v[o*O+U])/2;this.decodeAttrib2(e,o,h,c,l,d,y,v,g,b++)}else this.copyAttrib(o,v,g,R);this.accumulateNormal(B,O,R,v,m)}}for(var x=0;d>x;x++){var S=m[3*x],I=m[3*x+1],P=m[3*x+2],D=511/Math.sqrt(S*S+I*I+P*P),V=e.charCodeAt(l+5*d+x),j=e.charCodeAt(l+6*d+x),G=e.charCodeAt(l+7*d+x);y[o*x+5]=D*S+(V>>1^-(1&V)),y[o*x+6]=D*I+(j>>1^-(1&j)),y[o*x+7]=D*P+(G>>1^-(1&G))}s(a,i,y,f,void 0,t)},s.UTF8Loader.prototype.downloadMesh=function(e,t,r,i,s){function n(e){for(;h<r.length;){var a=r[h],n=a.indexRange;if(n){var c=n[0]+3*n[1];if(e.length<c)break;o.decompressMesh(e,a,i,t,h,s)}else{var l=a.codeRange,c=l[0]+l[1];if(e.length<c)break;o.decompressMesh2(e,a,i,t,h,s)}++h}}var o=this,h=0;a(e,function(e){n(e)})},s.UTF8Loader.prototype.downloadMeshes=function(e,t,r,a){for(var i in t){var s=t[i];this.downloadMesh(e+i,i,s,r,a)}},s.UTF8Loader.prototype.createMeshCallback=function(e,t,r){var a=0,i=0,n={},o={},h={},c=t.urls;for(var l in c)n[l]=c[l].length,o[l]=0,i++,h[l]=new s.Object3D;var d=new s.Object3D,u=new s.MTLLoader.MaterialCreator(e,t.options);u.setMaterials(t.materials),u.preload();var p=new s.UTF8Loader.BufferGeometryCreator,f=function(e,t,c,l,f,m){var g=p.create(c,l),v=u.create(m.material),y=new s.Mesh(g,v);h[e].add(y),o[e]++,o[e]===n[e]&&(a++,d.add(h[e]),a===i&&r(d))};return f},s.UTF8Loader.prototype.downloadModel=function(e,t,r,a){var i=this.createMeshCallback(t,r,a);this.downloadMeshes(e,r.urls,r.decodeParams,i)},s.UTF8Loader.prototype.downloadModelJson=function(e,t,r){i(e,function(a){a.decodeParams||(r&&r.decodeParams?a.decodeParams=r.decodeParams:a.decodeParams=n),a.options=r;var i=e.substr(0,e.lastIndexOf("/")+1),s=i;r&&r.geometryBase&&(i=r.geometryBase,"/"!==i.charAt(i.length-1)&&(i+="/")),r&&r.materialBase&&(s=r.materialBase,"/"!==s.charAt(s.length-1)&&(s+="/")),this.downloadModel(i,s,a,t)}.bind(this))}},function(e,t,r){var a=r(1);a.VRMLLoader=function(e){this.manager=void 0!==e?e:a.DefaultLoadingManager},a.VRMLLoader.prototype={constructor:a.VRMLLoader,isRecordingPoints:!1,isRecordingFaces:!1,points:[],indexes:[],isRecordingAngles:!1,isRecordingColors:!1,angles:[],colors:[],recordingFieldname:null,load:function(e,t,r,i){var s=this,n=new a.XHRLoader(this.manager);n.setCrossOrigin(this.crossOrigin),n.load(e,function(e){t(s.parse(e))},r,i)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=function(e,t){console.warn("VRML V1.0 not supported yet")},r=function(e,t){var r={},i=/(\b|\-|\+)([\d\.e]+)/,s=/([\d\.\+\-e]+)\s+([\d\.\+\-e]+)\s+([\d\.\+\-e]+)/g,n=function(e,t,r){var i=e.r-t.r,s=e.g-t.g,n=e.b-t.b,o=new a.Color;return o.r=e.r-r*i,o.g=e.g-r*s,o.b=e.b-r*n,o},o=function(e,t,r,i,s){for(var o,h,c,l,d,u,p,f,m=s?1:-1,g=["a","b","c","d"],v=[],y=1,b={},w={},x=!1,_=0;_<r.length;_++){var A={};A.y=m*(Math.cos(r[_])*t),A.x=m*(Math.sin(r[_])*t),v.push(A)}for(var k=0;k<e.faces.length;k++){o=e.faces[k],h=o instanceof a.Face3?3:4;for(var T=0;h>T;T++){l=o[g[T]],c=e.vertices[l];for(var M=0;M<i.length;M++)0===M?(b.x=0,b.y=s?t:-1*t):(b.x=v[M-1].x,b.y=v[M-1].y),w=v[M],void 0!==w?(x=s?c.y<=b.y&&c.y>w.y:c.y>=b.y&&c.y<w.y,x&&(p=i[M+1],u=i[M],y=Math.abs(c.y-b.y)/(b.y-w.y),d=n(u,p,y),o.vertexColors[T]=d)):void 0===o.vertexColors[T]&&(f=s?i.length-1:0,o.vertexColors[T]=i[f])}}},h=function(e,t){for(var r,a,n,o,h=[],c={},l=/[^\s,\[\]]+/g;null!=(r=l.exec(t));)h.push(r[0]);switch(a=h[0]){case"skyAngle":case"groundAngle":this.recordingFieldname=a,this.isRecordingAngles=!0,this.angles=[];break;case"skyColor":case"groundColor":this.recordingFieldname=a,this.isRecordingColors=!0,this.colors=[];break;case"point":this.recordingFieldname=a,this.isRecordingPoints=!0,this.points=[];break;case"coordIndex":this.recordingFieldname=a,this.isRecordingFaces=!0,this.indexes=[]}if(this.isRecordingFaces){if(h.length>0){o=[];for(var d=0;d<h.length;d++)/(-?\d+)/.test(h[d])&&("-1"===h[d]?(o.length>0&&this.indexes.push(o),o=[]):o.push(parseInt(h[d])))}/]/.exec(t)&&(this.isRecordingFaces=!1,e.coordIndex=this.indexes)}else if(this.isRecordingPoints){for(;null!==(h=s.exec(t));)n={x:parseFloat(h[1]),y:parseFloat(h[2]),z:parseFloat(h[3])},this.points.push(n);/]/.exec(t)&&(this.isRecordingPoints=!1,e.points=this.points)}else if(this.isRecordingAngles){if(h.length>0)for(var d=0;d<h.length;d++)i.test(h[d])&&this.angles.push(parseFloat(h[d]));/]/.exec(t)&&(this.isRecordingAngles=!1,e[this.recordingFieldname]=this.angles)}else if(this.isRecordingColors){for(;null!==(h=s.exec(t));)color={r:parseFloat(h[1]),g:parseFloat(h[2]),b:parseFloat(h[3])},this.colors.push(color);/]/.exec(t)&&(this.isRecordingColors=!1,e[this.recordingFieldname]=this.colors)}else if("NULL"!==h[h.length-1]&&"children"!==a){switch(a){case"diffuseColor":case"emissiveColor":case"specularColor":case"color":if(4!=h.length){console.warn("Invalid color format detected for "+a);break}c={r:parseFloat(h[1]),g:parseFloat(h[2]),b:parseFloat(h[3])};break;case"translation":case"scale":case"size":if(4!=h.length){console.warn("Invalid vector format detected for "+a);break}c={x:parseFloat(h[1]),y:parseFloat(h[2]),z:parseFloat(h[3])};break;case"radius":case"topRadius":case"bottomRadius":case"height":case"transparency":case"shininess":case"ambientIntensity":if(2!=h.length){console.warn("Invalid single float value specification detected for "+a);break}c=parseFloat(h[1]);break;case"rotation":if(5!=h.length){console.warn("Invalid quaternion format detected for "+a);break}c={x:parseFloat(h[1]),y:parseFloat(h[2]),z:parseFloat(h[3]),w:parseFloat(h[4])};break;case"ccw":case"solid":case"colorPerVertex":case"convex":if(2!=h.length){console.warn("Invalid format detected for "+a);break}c="TRUE"===h[1]}e[a]=c}return c},c=function(e){for(var t,r,a={string:"Scene",children:[]},i=a,s=0;s<e.length;s++){var n="",o=e[s];if(null===(result=/^\s+?$/g.exec(o))&&(o=o.trim(),""!==o)){if(/#/.exec(o)){var c=o.split("#");o=c[0],n=c[1]}if(t=/([^\s]*){1}\s?{/.exec(o)){var l={nodeType:t[1],string:o,parent:i,children:[],comment:n};i.children.push(l),i=l,/}/.exec(o)&&(r=/{(.*)}/.exec(o)[1],l.children.push(r),h(i,r),i=i.parent)}else/}/.exec(o)?i=i.parent:""!==o&&(h(i,o),i.children.push(o))}}return a},l=function(e,i){if("string"!=typeof e){var s=i;if("Transform"===e.nodeType||"Group"===e.nodeType){if(s=new a.Object3D,/DEF/.exec(e.string)&&(s.name=/DEF\s+(\w+)/.exec(e.string)[1],r[s.name]=s),void 0!==e.translation){var n=e.translation;
s.position.set(n.x,n.y,n.z)}if(void 0!==e.rotation){var h=e.rotation;s.quaternion.setFromAxisAngle(new a.Vector3(h.x,h.y,h.z),h.w)}if(void 0!==e.scale){var c=e.scale;s.scale.set(c.x,c.y,c.z)}i.add(s)}else if("Shape"===e.nodeType)s=new a.Mesh,/DEF/.exec(e.string)&&(s.name=/DEF (\w+)/.exec(e.string)[1],r[s.name]=s),i.add(s);else if("Background"===e.nodeType){var d=20,u=2e4,p=new a.SphereGeometry(u,d,d),f=new a.MeshBasicMaterial({fog:!1,side:a.BackSide});if(e.skyColor.length>1)o(p,u,e.skyAngle,e.skyColor,!0),f.vertexColors=a.VertexColors;else{var m=e.skyColor[0];f.color.setRGB(m.r,m.b,m.g)}if(t.add(new a.Mesh(p,f)),void 0!==e.groundColor){u=12e3;var g=new a.SphereGeometry(u,d,d,0,2*Math.PI,.5*Math.PI,1.5*Math.PI),v=new a.MeshBasicMaterial({fog:!1,side:a.BackSide,vertexColors:a.VertexColors});o(g,u,e.groundAngle,e.groundColor,!1),t.add(new a.Mesh(g,v))}}else{if(/geometry/.exec(e.string)){if("Box"===e.nodeType){var c=e.size;i.geometry=new a.BoxGeometry(c.x,c.y,c.z)}else if("Cylinder"===e.nodeType)i.geometry=new a.CylinderGeometry(e.radius,e.radius,e.height);else if("Cone"===e.nodeType)i.geometry=new a.CylinderGeometry(e.topRadius,e.bottomRadius,e.height);else if("Sphere"===e.nodeType)i.geometry=new a.SphereGeometry(e.radius);else if("IndexedFaceSet"===e.nodeType){for(var y,b=new a.Geometry,w=0,x=e.children.length;x>w;w++){var _,A=e.children[w];if("Coordinate"===A.nodeType){for(var k=0,T=A.points.length;T>k;k++){var M=A.points[k];_=new a.Vector3(M.x,M.y,M.z),b.vertices.push(_)}break}}for(var C=0,w=0,x=e.coordIndex.length;x>w;w++)for(y=e.coordIndex[w],C=0;y.length>=3&&C<y.length-2;){var L=new a.Face3(y[0],y[C+1],y[C+2],null);C++,b.faces.push(L)}!1===e.solid&&(i.material.side=a.DoubleSide),b.solid=e.solid,b.computeFaceNormals(),b.computeBoundingSphere(),/DEF/.exec(e.string)&&(b.name=/DEF (\w+)/.exec(e.string)[1],r[b.name]=b),i.geometry=b}return}if(/appearance/.exec(e.string)){for(var w=0;w<e.children.length;w++){var A=e.children[w];if("Material"===A.nodeType){var N=new a.MeshPhongMaterial;if(void 0!==A.diffuseColor){var U=A.diffuseColor;N.color.setRGB(U.r,U.g,U.b)}if(void 0!==A.emissiveColor){var E=A.emissiveColor;N.emissive.setRGB(E.r,E.g,E.b)}if(void 0!==A.specularColor){var c=A.specularColor;N.specular.setRGB(c.r,c.g,c.b)}if(void 0!==A.transparency){var n=A.transparency;N.opacity=Math.abs(1-n),N.transparent=!0}/DEF/.exec(e.string)&&(N.name=/DEF (\w+)/.exec(e.string)[1],r[N.name]=N),i.material=N;break}}return}}for(var w=0,T=e.children.length;T>w;w++){var A=e.children[w];l(e.children[w],s)}}else if(/USE/.exec(e)){var F=/USE\s+?(\w+)/.exec(e)[1];if(void 0==r[F])console.warn(F+" is not defined.");else if(/appearance/.exec(e)&&F)i.material=r[F].clone();else if(/geometry/.exec(e)&&F)i.geometry=r[F].clone(),void 0!==r[F].solid&&r[F].solid===!1&&(i.geometry.solid=!1,i.material.side=a.DoubleSide);else if(F){var s=r[F].clone();i.add(s)}}};l(c(e),t)},i=new a.Scene,s=e.split("\n"),n=s.shift();return/V1.0/.exec(n)?t(s,i):/V2.0/.exec(n)&&r(s,i),i}}},function(e,t,r){var a=r(1);a.VTKLoader=function(e){this.manager=void 0!==e?e:a.DefaultLoadingManager},a.VTKLoader.prototype={constructor:a.VTKLoader,load:function(e,t,r,i){var s=this,n=new a.XHRLoader(s.manager);n.setCrossOrigin(this.crossOrigin),n.load(e,function(e){t(s.parse(e))},r,i)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){for(var t,r=[],i=[],s=/([\-]?[\d]+[\.]?[\d|\-|e]*)[ ]+([\-]?[\d]+[\.]?[\d|\-|e]*)[ ]+([\-]?[\d]+[\.]?[\d|\-|e]*)/g,n=/^3[ ]+([\d]+)[ ]+([\d]+)[ ]+([\d]+)/,o=/^4[ ]+([\d]+)[ ]+([\d]+)[ ]+([\d]+)[ ]+([\d]+)/,h=/^POINTS /,c=/^POLYGONS /,l=!1,d=!1,u=e.split("\n"),p=0;p<u.length;++p){if(line=u[p],l)for(;null!==(t=s.exec(line));)i.push(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]));else d&&(t=n.exec(line),null!==t?r.push(parseInt(t[1]),parseInt(t[2]),parseInt(t[3])):(t=o.exec(line),null!==t&&(r.push(parseInt(t[1]),parseInt(t[2]),parseInt(t[4])),r.push(parseInt(t[2]),parseInt(t[3]),parseInt(t[4])))));null!==c.exec(line)&&(l=!1,d=!0),null!==h.exec(line)&&(d=!1,l=!0)}var f=new a.BufferGeometry;return f.setIndex(new a.BufferAttribute(new(r.length>65535?Uint32Array:Uint16Array)(r),1)),f.addAttribute("position",new a.BufferAttribute(new Float32Array(i),3)),f}},a.EventDispatcher.prototype.apply(a.VTKLoader.prototype)},function(e,t,r){var a=r(1),i=r(27),s=function(e){this.manager=void 0!==e?e:a.DefaultLoadingManager,"default"==this.responseType};s.prototype={constructor:s,load:function(e,t,r,a){function s(e){for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),a=0;a<e.length;++a)r[a]=e[a];return t}var n=this;i.readFile(e,{},function(r,i){if(r)console.error(r),a&&a(r);else{if("arraybuffer"==n.responseType){var o=s(i);t&&t(o)}else t&&t(i.toString());n.manager.itemEnd(e)}}),n.manager.itemStart(e)},setResponseType:function(e){this.responseType=e},setCrossOrigin:function(e){},setWithCredentials:function(e){}},e.exports=s},function(e,t){}]);